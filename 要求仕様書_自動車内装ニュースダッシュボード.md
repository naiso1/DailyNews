# 要求仕様書：自動車内装製品デイリーニュース・ダッシュボード運用システム

---

## 1. 文書情報
* **文書名**：自動車内装製品デイリーニュース・ダッシュボード運用更新システム 要求仕様書
* **作成日**：2025年12月14日
* **最終更新日**：2025年12月16日
* **対象プロジェクト**：内装製品デイリーニュース.html
* **版数**：Ver. 3.0

---

## 2. プロジェクト概要
本プロジェクトは、日本・中国・インドを中心とした「自動車内装製品」に関する最新ニュースを日次で収集し、閲覧・検索・分析が可能なWebダッシュボード（`内装製品デイリーニュース.html`）を運用することを目的とする。
ユーザーは最新のニュース情報をテキスト形式で提供するだけで、システム（AIおよびスクリプト）が半自動的にHTMLを更新し、画像取得・整形を行う運用フローを構築する。

---

## 3. システム機能要件

### 3.1 ダッシュボード（フロントエンド）機能
* **デザイン・UI**:
    * **ダークモード基調**: 暗色背景にネオンカラー（アクセント）を用いたモダンでプレミアムなデザイン。
    * **レスポンシブ対応**: PCおよびモバイル端末で見やすいグリッドレイアウトを採用。
* **フィルタリング・検索機能**:
    * **国別フィルタ**: 「日本」「中国」「インド」「世界版」の切り替えが可能。国旗アイコン（CSS描画）を使用し、OS依存の表示崩れを防ぐ。
    * **タグフィルタ**: `HMI`, `プレミアム`, `加飾` 等のタグによる絞り込み。
    * **日付フィルター**: 開始日・終了日を指定した期間絞り込み。
    * **キーワード検索**: タイトル、概要、タグ等を対象としたリアルタイムフィルタリング。
    * **ソート機能**: 日付の「新しい順」「古い順」切り替え。
* **ニュースカード表示**:
    * 各ニュースをカード形式で表示（サムネイル画像、タイトル、概要、国旗バッジ、日付、ソース元リンク）。
    * **詳細要約開閉**: 「詳細要約を見る」ボタンによるアコーディオン表示。
    * **画像注釈**: 画像上に「※イメージ画像」注釈を表示（Unsplash等のプレースホルダー画像使用時に自動表示）。
* **インサイト（考察・アイデア）セクション**:
    * **考察 (Analysis)**: 国ごとにカード化されたグリッドレイアウト。重要キーワードは太字・背景色でハイライト表示。
    * **企画アイデア (Ideas)**: 国ごとにセクション分割。各アイデアは画像とテキストを横並びにしたリッチなカードデザインで表示。
    * **画像連動**: 企画アイデアにはAI生成されたコンセプト画像（`images/` フォルダ参照）を表示。

### 3.2 データ管理・バックエンド機能
* **データ構造の分離**:
    * `news_data.js`: ニュース記事本体データ。
    * `insights_data.js`: 考察および企画アイデアのデータ。
* **画像生成・管理**:
    * 企画アイデア用のコンセプト画像をAIにより生成し、ローカルの `images/` フォルダで管理。
    * スクリプトにより自動的にリネーム・フォルダ移動を行う運用。

---

## 4. 運用ワークフロー（Update Workflow）

### 【Step 1】 データの追加
ユーザーから提供されたニュース情報、またはAIが収集した情報を元に、以下のデータを更新する。
1. `news_data.js`: ニュース記事情報の追加。
2. `insights_data.js`: 日次の考察と、それに基づく企画アイデアの記述を追加。

### 【Step 2】 記事画像の取得
各ニュース記事の画像を以下の優先順位で取得する：
1. **記事ページからの直接抽出**: HTMLソースから`og:image`、`data-src`、`src`属性を正規表現で抽出。
2. **ユーザー指定URL**: ユーザーが直接画像URLを提供した場合はそれを使用。
3. **プレースホルダー画像**: 取得不可の場合はUnsplash等の汎用画像を使用し、「※イメージ画像」注釈を自動表示。

### 【Step 3】 アイデア画像の生成と配置
企画アイデア（`insights_data.js` 内の `ideas`）に対応するコンセプト画像をAI生成ツールを用いて作成する。
* 生成された画像はタイムスタンプ付きのファイル名から、簡潔な名前にリネーム（例: `jp_compact_hmi_1214.png`）。
* 画像ファイルは `images/` フォルダに格納する。
* 命名規則: `{国コード}_{内容}_{日付}.png`（例: `cn_wellness_console_1214.png`）

### 【Step 4】 ファイルパスの更新
`news_data.js` および `insights_data.js` 内の画像パスを `images/ファイル名.png` に更新し、HTML側で正しく読み込めるようにする。

---

## 5. 画像取得仕様

### 5.1 記事画像の取得ロジック
* **HTMLソースからの抽出**:
  * `og:image` メタタグ → 最優先
  * `data-src` / `data-original` 属性 → 遅延読み込み画像用
  * `src` 属性 → 通常の画像タグ
  * プロトコル相対URL（`//`で始まるもの）にも対応
* **フィルタリング**:
  * `logo`, `icon`, `avatar`, `ad`, `banner` を含むURLは除外
  * 5KB未満の小さなファイルは除外
* **サイト別対応**:
  * Sohu: `q*.itc.cn` ドメインの画像
  * PCAuto: `img*.pcauto.com.cn` ドメインの画像
  * Sina: `n.sinaimg.cn` ドメインの画像
  * DTM: `www.dtm.com.cn/file/upload/` パスの画像

### 5.2 「※イメージ画像」注釈表示条件
* 画像URLに `unsplash` または `generic` が含まれる場合に自動表示
* ローカルに保存された実記事画像には表示されない

---

## 6. これまでの実装・改修履歴

| 実装日 | 内容 | 詳細 |
|:---|:---|:---|
| 初期 | ダッシュボード構築 | 3カ国対応、フィルタリング、検索機能の実装。 |
| 12/04 | 中国ニュース追加 | Xiaomi、BYD等の中国市場ニュース追加。 |
| 12/10 | インドニュース追加 | Kia Seltos発表などインド市場ニュース追加。 |
| 12/12 | 画像取得ロジック改善 | 記事内画像の優先取得、リンク切れ対応、注釈機能。 |
| 12/14 | **UI/UX大幅刷新** | 考察・アイデア欄のレイアウト改善（カード化、ハイライト）。CSS国旗アイコン実装。 |
| 12/14 | **画像生成連携** | 企画アイデアの画像をAI生成し、`images/` フォルダでローカル管理する仕組みを導入。 |
| 12/14 | **日付フィルタ改善** | 日付範囲指定フィルターの実装。 |
| 12/15 | **中国ニュース (cn41-cn50) 大幅更新** | 記事内容の全面更新、URL修正、画像再取得。 |
| 12/15 | **cn42記事削除** | autohome.com.cn の極氪8X記事を削除（URLエラー）。 |
| 12/15 | **URL変更対応** | cn41→dayoo.com、cn43→新pcauto URL、cn45→新sina URLに変更。 |
| 12/15 | **画像抽出ロジック強化** | 正規表現を改良し、`data-src`、プロトコル相対URLにも対応。 |
| 12/15 | **2025-12-14 企画アイデア画像生成** | 中国・日本・インド各2件、計6件のコンセプト画像をAI生成。 |

---

## 7. 技術仕様・ファイル構成

* **メインファイル**: `内装製品デイリーニュース.html`
* **データファイル**: 
    * `news_data.js`: ニュース記事リスト
    * `insights_data.js`: 考察・アイデアリスト
* **リソース**: `images/` フォルダ（ローカル画像格納用）
* **補助スクリプト（Python）**:
    * 画像取得スクリプト: 正規表現によるHTML解析、SSL対応
    * パス更新スクリプト: データファイルの画像パス一括更新

### 7.1 画像ファイル命名規則
| 種別 | 命名規則 | 例 |
|:---|:---|:---|
| 記事画像 | `{記事ID}.{拡張子}` | `cn41.jpg`, `jp42.png` |
| 企画アイデア画像 | `{国コード}_{内容}_{日付}.png` | `cn_wellness_console_1214.png` |

---

## 8. 運用上の注意事項

### 8.1 記事URLについて
* 中国系ニュースサイトは記事の削除・移動が早いため、404エラーが発生しやすい
* 404エラー発生時は代替URLへの変更、または記事削除で対応
* ユーザーから代替URLの提供があった場合は速やかに反映

### 8.2 画像取得について
* 自動取得が困難な場合はユーザーに画像URLの提供を依頼
* 取得不可の場合はUnsplashプレースホルダーを使用し「※イメージ画像」を表示
* 実記事画像が取得できた場合はローカルに保存し、注釈は非表示

### 8.3 データ整合性
* 記事削除時は `news_data.js` から該当オブジェクトを完全に削除
* ID重複がないよう注意（cn41, cn43, cn44... の連番管理）

---

## 9. 今後の拡張性
* **自動要約の強化**: URL入力のみからの完全自動アーカイビング。
* **多言語対応**: UIの英語/日本語切り替え機能。
* **CMS化**: 編集作業をブラウザ上で行える管理画面の導入（現在はファイル直接編集）。
* **画像取得の自動化強化**: より多くのサイト形式に対応した汎用スクレイピングロジック。
* **GitHub Pages連携**: 自動デプロイによる公開フローの効率化。

