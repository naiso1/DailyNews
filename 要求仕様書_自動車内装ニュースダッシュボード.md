# 要求仕様書：自動車内装製品デイリーニュース・ダッシュボード運用システム

---

## 1. 文書情報
* **文書名**：自動車内装製品デイリーニュース・ダッシュボード運用更新システム 要求仕様書
* **作成日**：2025年12月14日
* **最終更新日**：2026年01月30日
* **対象プロジェクト**：内装製品デイリーニュース.html
* **版数**：Ver. 6.0

---

## 2. プロジェクト概要
本プロジェクトは、日本・中国・インド・米国・欧州を中心とした「自動車内装製品」に関する最新ニュースを日次で収集し、閲覧・検索・分析が可能なWebダッシュボード（`内装製品デイリーニュース.html`）を運用することを目的とする。加えて論文（Papers）をニュースと同様に閲覧できる。
ユーザーは最新のニュース情報をテキスト形式で提供するだけで、システム（AIおよびスクリプト）が半自動的にHTMLを更新し、画像取得・整形を行う運用フローを構築する。
画面の主要メッセージは「生成AIによって前日の内装製品ニュースを収集、要約・翻訳、分析、考察、企画アイデア例をお届け。」を表示する。

---

## 3. システム機能要件

### 3.1 ダッシュボード（フロントエンド）機能
* **デザイン・UI**:
    * **ダークモード基調**: 暗色背景にネオンカラー（アクセント）を用いたモダンでプレミアムなデザイン。
    * **レスポンシブ対応**: PCおよびモバイル端末で見やすいグリッドレイアウトを採用。
* **フィルタリング・検索機能**:
    * **国別フィルタ**: 「🌍世界版」「日本」「中国」「インド」「米国」「欧州」「論文」を**複数選択**可能。世界版は全対象表示。国旗は画像アイコンを使用する。論文は📄アイコン。
    * **タグフィルタ**: `HMI`, `プレミアム`, `加飾` 等のタグによる絞り込み。**タグは1行表示＋「もっと見る」展開**に対応。
    * **日付フィルター**: 開始日・終了日を指定した期間絞り込み。
    * **キーワード検索**: タイトル・概要・タグ等を対象としたリアルタイムフィルタリング。**タグクリックは検索欄に反映され、タイトル/本文も対象**。
    * **ソート機能**: 
        * 日付の「新しい順」「古い順」切り替え
        * 「いいね数」「コメント数」による並び替え
* **ニュースカード表示**:
    * 各ニュースをカード形式で表示（サムネイル画像、タイトル、概要、国旗バッジ、日付、ソース元リンク）。
    * **NEWバッジ**: 最新のニュース追加期間（例: 2025-12-29以降）のニュースに赤い「NEW」バッジを画像左上に表示。アニメーション付き。
    * **国名バッジ**: 画像左上に表示。NEWバッジがある場合はその下に配置し、重ならないようにする。
    * **IDバッジ**: 記事IDを画像内ではなく、カードフッターの出典（source）横に表示。
    * **詳細要約開閉**: 「詳細要約を見る」ボタンによるアコーディオン表示。
    * **画像注釈**: 
        * 画像上に「※イメージ画像」注釈を表示（Unsplash等のプレースホルダー画像使用時に自動表示）
        * **note欄での注釈表記**: `note` フィールドに「※イメージ画像／」を含める形式で明示的に表示
    * **インタラクション機能**:
        * いいねボタン（ハートアイコン）: オプティミスティックUIで即座にカウント反映
        * コメント機能: 記事ごとにコメント投稿・表示が可能
        * **閲覧数**: 記事カードに小さく表示。**「記事を読む」クリックまたは5秒マウスオーバーで加算**。1端末・1記事・1日1回のみカウント。
* **インサイト（考察・アイデア）セクション**:
    * **考察 (Analysis)**: 国ごとにカード化されたグリッドレイアウト。重要キーワードは太字・背景色でハイライト表示。
    * **企画アイデア (Ideas)**: 国ごとにセクション分割。各アイデアは画像とテキストを横並びにしたリッチなカードデザインで表示。
    * **画像連動**: 企画アイデアにはAI生成されたコンセプト画像（`images/` フォルダ参照）を表示。
    * **ID管理**: アイデアIDは日付順に連番で管理（古い日付から新しい日付へ1から順番に採番）
    * **表示制御**: デフォルトは**最新のみ表示**。古い考察/アイデアは「もっと見る」で展開。アイデアは**2列（横並び）**、スマホは縦。
* **ランキング機能**:
    * **ニュースランキング**: 総合/いいね/コメント/閲覧で並び替え。**総合＝いいね×3＋コメント×2＋閲覧**。
    * **論文ランキング**: 論文のみ対象。**期間はデフォルト6か月以内**。
    * **表示条件**: 論文選択時はニュースランキング非表示。ニュース選択時は論文ランキング非表示。お気に入り表示時はランキング非表示。
    * **上位のみ既定表示**: 初期はトップ3件表示、展開で全件。
* **アクセス分析**:
    * ヘッダーの「総アクセス数」横に**目立たない分析ボタン**を設置し、日別アクセス推移の簡易グラフを表示。
    * 日別アクセス保持期間は**30日**。
    * 日付判定は**JST固定**で今日/昨日を算出する。
* **お気に入り**:
    * 記事・アイデアをお気に入り登録。お気に入り表示時は**考察を非表示**、お気に入りのみ表示。
    * **CSV出力**・**メール共有**（mailto）を用意。メールはHTML整形を試みるが、クライアントによっては生HTML表示になる可能性がある。
* **クイックナビ**:
    * 「トップ / ニュース / 考察 / 企画アイデア」へのジャンプリンクを画面右下に表示。

### 3.2 データ管理・バックエンド機能
* **データ構造の分離**:
    * `news_data.js`: ニュース記事本体データ。
    * `insights_data.js`: 考察および企画アイデアのデータ。
* **インタラクションデータ**:
    * いいね・コメント・閲覧・アクセス数は**端末（localStorage）で管理**し、1端末・1日1回のカウント制御を行う。
    * Firebase連携は任意（利用する場合は `interactions` 等のコレクションで管理）。
* **画像生成・管理**:
    * 企画アイデア用のコンセプト画像をAIにより生成し、ローカルの `images/` フォルダで管理。
    * スクリプトにより自動的にリネーム・フォルダ移動を行う運用。

---

## 4. 運用ワークフロー（Update Workflow）

### 【Step 0】 画像レビュー用データ生成と選択
1. `python prepare_review_data.py` を実行し、対象日付（現状は 2025-12-18〜21）の記事から画像候補を収集して `review_data.json` を生成する。
2. `review_interior.html` をローカルHTTPサーバ（例: `python -m http.server 8000`）経由で開き、現行画像と候補画像を並べて比較する。`file://` で開く場合は画面上の「JSONを読み込む」で `review_data.json` を手動指定する。
3. 差し替えたい候補を選択し、JSON/CSV をクリップボードにコピーする。
4. その選択JSONを `apply_selected_images.py` の `SELECTED` に貼り付け、`python apply_selected_images.py` で `news_data.js` の `img` を一括更新する（空文字はスキップ）。

### 【Step 1】 データの追加
ユーザーから提供されたニュース情報、またはAIが収集した情報を元に、以下のデータを更新する。
1. `news_data.js`: ニュース記事情報の追加（`sheet2_llm_targets.csv` を反映）。
2. `insights_data.js`: 日次の考察と、それに基づく企画アイデアの記述を追加。
3. `papers_sheet2.csv`: 論文データを `news_data.js` に追加（country=paper）。

**日本語化原則**: 
* 中国語・英語などの原文ニュースのタイトル、説明、タグはすべて日本語に翻訳して記載する
* 企業名・製品名は適切なカタカナ表記または原語を使用

### 【Step 2】 記事画像の取得
各ニュース記事の画像を以下の優先順位で取得する：
1. **記事ページからの直接抽出**: HTMLソースから`og:image`、`data-src`、`src`属性を正規表現で抽出。
2. **ブラウザ操作による取得**: 動的サイトの場合はブラウザサブエージェントを使用してJavaScript実行後のDOM解析。
3. **ユーザー指定URL**: ユーザーが直接画像URLを提供した場合はそれを使用。
4. **プレースホルダー画像**: 取得不可の場合はUnsplash等の汎用画像を使用し、「※イメージ画像」注釈を表示。

**画像選択基準**:
* **車内インテリア画像を優先**: ダッシュボード、コックピット、シート等の内装画像を最優先
* 外装画像しか取得できない場合は外装画像を使用
* 画像が見つからない場合は `note` 欄に「※イメージ画像／」を付与

### 【Step 3】 アイデア画像の生成と配置
企画アイデア（`insights_data.js` 内の `ideas`）に対応するコンセプト画像をAI生成ツールを用いて作成する。
* 生成された画像はタイムスタンプ付きのファイル名から、簡潔な名前にリネーム（例: `jp_compact_hmi_1214.png`）。
* 画像ファイルは `images/` フォルダに格納する。
* 命名規則: `{国コード}_{内容}_{日付}.png`（例: `cn_wellness_console_1214.png`）

### 【Step 4】 ファイルパスの更新
`news_data.js` および `insights_data.js` 内の画像パスを `images/ファイル名.png` に更新し、HTML側で正しく読み込めるようにする。

---

## 5. 画像取得仕様

### 5.1 記事画像の取得ロジック
* **HTMLソースからの抽出**:
  * `og:image` メタタグ → 最優先
  * `data-src` / `data-original` 属性 → 遅延読み込み画像用
  * `src` 属性 → 通常の画像タグ
  * プロトコル相対URL（`//`で始まるもの）にも対応
* **フィルタリング**:
  * `logo`, `icon`, `avatar`, `ad`, `banner` を含むURLは除外
  * 5KB未満の小さなファイルは除外
* **サイト別対応**:
  * Sohu: `q*.itc.cn` ドメインの画像
  * PCAuto: `img*.pcauto.com.cn` ドメインの画像
  * Sina: `n.sinaimg.cn` ドメインの画像
  * DTM: `www.dtm.com.cn/file/upload/` パスの画像
  * 腾讯新闻: `inews.gtimg.com` ドメインの画像
  * IT之家: `img.ithome.com` ドメインの画像
  * 汽車之家: `www*.autoimg.cn` ドメインの画像

### 5.2 「※イメージ画像」注釈表示条件
* 画像URLに `unsplash` または `placeholder` が含まれる場合に自動表示
* `note` フィールドに「※イメージ画像」が含まれる場合に表示
* ローカルに保存された実記事画像には表示されない

---

## 6. これまでの実装・改修履歴

| 実装日 | 内容 | 詳細 |
|:---|:---|:---|
| 初期 | ダッシュボード構築 | 3カ国対応、フィルタリング、検索機能の実装。 |
| 12/04 | 中国ニュース追加 | Xiaomi、BYD等の中国市場ニュース追加。 |
| 12/10 | インドニュース追加 | Kia Seltos発表などインド市場ニュース追加。 |
| 12/12 | 画像取得ロジック改善 | 記事内画像の優先取得、リンク切れ対応、注釈機能。 |
| 12/14 | **UI/UX大幅刷新** | 考察・アイデア欄のレイアウト改善（カード化、ハイライト）。CSS国旗アイコン実装。 |
| 12/14 | **画像生成連携** | 企画アイデアの画像をAI生成し、`images/` フォルダでローカル管理する仕組みを導入。 |
| 12/14 | **日付フィルタ改善** | 日付範囲指定フィルターの実装。 |
| 12/15 | **中国ニュース (cn41-cn50) 大幅更新** | 記事内容の全面更新、URL修正、画像再取得。 |
| 12/15 | **cn42記事削除** | autohome.com.cn の極氪8X記事を削除（URLエラー）。 |
| 12/15 | **URL変更対応** | cn41→dayoo.com、cn43→新pcauto URL、cn45→新sina URLに変更。 |
| 12/15 | **画像抽出ロジック強化** | 正規表現を改良し、`data-src`、プロトコル相対URLにも対応。 |
| 12/15 | **2025-12-14 企画アイデア画像生成** | 中国・日本・インド各2件、計6件のコンセプト画像をAI生成。 |
| 12/17 | **Firebase連携追加** | いいね・コメント機能のためにFirebase Firestoreを導入。 |
| 12/17 | **ソート機能拡張** | いいね数・コメント数による並び替え機能を追加。 |
| 12/17 | **ドロップダウン視認性改善** | ソート順ドロップダウンのダーク背景・白文字スタイルを適用。 |
| 12/18 | **2025-12-17 ニュース追加** | 日本10件、中国10件、インド10件の計30件を追加。 |
| 12/18 | **インサイトID連番化** | 全日付のアイデアIDを1〜38まで日付順に再番号付け。 |
| 12/18 | **insights_data.js構文修正** | エスケープされていないダブルクォートによる構文エラーを全面修正。 |
| 12/18 | **オプティミスティックUI実装** | いいねボタンの即時反映（サーバー応答前にUI更新）を実装。 |
| 12/22 | **2025-12-18〜21 日本ニュース追加** | jp80〜jp88の9件を追加。 |
| 12/22 | **2025-12-18〜21 中国ニュース追加** | cn51〜cn60の10件を追加（零跑D19、昊铂A800、智趣烈馬 等）。 |
| 12/22 | **2025-12-18〜21 インドニュース追加** | in71〜in80の10件を追加（ZF静粛化技術、XUV 7XO、Gravite 等）。 |
| 12/22 | **2025-12-18 考察・アイデア追加** | 日本・中国・インド各2件、計6件のアイデアとAI画像を追加（ID 37〜42）。 |
| 12/22 | **画像URL検証・修正** | cn53（昊铂A800）、cn59（零跑D19）の画像URLを正しい内装画像に更新。 |
| 12/22 | **イメージ画像注釈追加** | cn56（安通林）に「※イメージ画像」表記を追加。 |
| 12/22 | **画像レビュー／反映フロー追加** | `prepare_review_data.py` で候補収集、`review_interior.html` で新旧比較と選択、`apply_selected_images.py` で `news_data.js` の `img` を一括更新。jp80/jp82/jp83/jp84/jp88/cn52/cn54/cn55/cn56/cn57/cn60/in75/in78 を差し替え。 |
| 01/06 | **国別フィルタ単一選択化** | 複数選択から単一選択方式に変更。「世界版」で全ニュース表示、各国選択でその国のみ表示。 |
| 01/06 | **NEWバッジ機能追加** | 最新ニュース（2025-12-29以降）にアニメーション付き「NEW」バッジを表示。考察・アイデアセクションにも対応。 |
| 01/06 | **レイアウト改善** | NEWバッジと国名バッジの重なりを解消。IDバッジを画像内からカードフッター（出典横）に移動。 |
| 01/06 | **壊れた画像URL修正** | `image.thum.io`（12件）、`googleusercontent.com`（10件）を使用したURLをプレースホルダー画像に置換。 |
| 01/06 | **リンク切れ記事修正** | Bingリダイレクトリンク（jp141, jp145, jp146, us23）を正しいURLに更新、またはプレースホルダーに変更。 |
| 01/06 | **タグ更新** | 新規追加ニュース（jp107, jp139-144, us18-22, eu7-9, cn81-84, in86-88等）に具体的なタグを追加。 |
| 01/07 | **アクセス不可記事削除** | URLが欠損または404/403エラーの15件を削除（us4, us13, jp136, jp137, cn72-cn79, jp141, us23, jp145）。最終ニュース数: 359件。 |
| 01/08 | **jp146削除** | リンク切れのため記事削除。 |
| 01/08 | **アクセスカウンター追加** | ヘッダーに総アクセス数・本日のアクセス数をFirebase連携で表示。 |
| 01/08 | **NEWバッジ対象日変更** | 2025-12-29以降→2026-01-06のみに変更。考察セクションも同様。 |
| 01/08 | **タグクリック検索機能** | ニュースカードのタグをクリックするとそのキーワードで検索。 |
| 01/08 | **企画アイデア表示制限** | 初期表示3回分、以降は「もっと見る」ボタンで追加読み込み。 |
| 01/08 | **プロンプトテンプレート作成** | 考察・アイデア生成用プロンプトを `.agent/prompts/` に保存。 |

---

## 7. 技術仕様・ファイル構成

* **メインファイル**: `内装製品デイリーニュース.html`
* **データファイル**: 
    * `news_data.js`: ニュース記事リスト
    * `insights_data.js`: 考察・アイデアリスト
* **リソース**: `images/` フォルダ（ローカル画像格納用）
* **補助スクリプト（Python）**:
    * 画像取得スクリプト: 正規表現によるHTML解析、SSL対応
    * パス更新スクリプト: データファイルの画像パス一括更新
    * `robust_scrape_cn.py`: 中国サイト用の堅牢なスクレイピングスクリプト
    * `prepare_review_data.py`: 記事URLから画像候補を収集し `review_data.json` を生成
    * `apply_selected_images.py`: 選択JSONに基づき `news_data.js` の `img` を一括更新
* **外部サービス**:
    * Firebase Firestore: いいね・コメントデータの永続化

* **レビュー用HTML**:
    * `review_interior.html`: `review_data.json` を読み込み、新旧画像を並べて選択しJSON/CSVをコピー。`file://` ではフェッチ不可のため、HTTPサーバ経由または画面ボタンでローカルJSONを読み込む。

### 7.1 画像ファイル命名規則
| 種別 | 命名規則 | 例 |
|:---|:---|:---|
| 記事画像 | `{記事ID}.{拡張子}` | `cn41.jpg`, `jp42.png` |
| 企画アイデア画像 | `{国コード}_{内容}_{日付}.png` | `cn_wellness_console_1214.png` |

### 7.2 データ構造仕様

#### news_data.js
```javascript
{
    id: "jp80",           // ユニークID（国コード + 連番）
    title: "記事タイトル",  // 日本語タイトル
    desc: "記事概要",       // 日本語での概要説明
    url: "https://...",    // 元記事URL
    source: "ソース名",     // 出典サイト名
    date: "2025-12-18",    // YYYY-MM-DD形式
    tags: ["タグ1", "タグ2"], // 日本語タグ配列
    country: "jp",         // jp / cn / in / us / eu / paper
    img: "画像URL",        // 画像パスまたはURL
    note: "補足"           // カード上の補足表示（※イメージ画像表記等）
}
```

#### insights_data.js
```javascript
{
    date: "2025-12-18",
    analysis: {
        jp: "日本市場の考察...",
        cn: "中国市場の考察...",
        in: "インド市場の考察...",
        us: "米国市場の考察...",
        eu: "欧州市場の考察..."
    },
    ideas: {
        jp: [
            { id: 37, img: "images/...", title: "タイトル", desc: "説明" }
        ],
        cn: [...],
        in: [...],
        us: [...],
        eu: [...]
    }
}
```

---

## 8. 運用上の注意事項

### 8.1 記事URLについて
* 中国系ニュースサイトは記事の削除・移動が早いため、404エラーが発生しやすい
* 404エラー発生時は代替URLへの変更、または記事削除で対応
* ユーザーから代替URLの提供があった場合は速やかに反映

### 8.2 画像取得について
* 自動取得が困難な場合はブラウザサブエージェントを使用
* 取得不可の場合はUnsplashプレースホルダーを使用し「※イメージ画像」を表示
* 実記事画像が取得できた場合はローカルに保存し、注釈は非表示
* **内装画像を優先**: コックピット、ダッシュボード、シート等の画像を優先取得
* **note欄での明示**: イメージ画像使用時は `note` 欄に「※イメージ画像／説明」の形式で記載

### 8.3 データ整合性
* 記事削除時は `news_data.js` から該当オブジェクトを完全に削除
* ID重複がないよう注意（cn41, cn43, cn44... の連番管理）
* `insights_data.js` のアイデアIDは全日付を通じて連番（古い日付から順に採番）

### 8.4 日本語化ルール
* ニュースタイトル・説明・タグはすべて日本語で記載
* 企業名は適切なカタカナ表記または原語を使用（例：零跑、昊铂、マヒンドラ）
* 技術用語は業界標準の日本語訳を使用（例：アンビエントライト、ゼログラビティシート）

---

## 9. 今後の拡張性
* **自動要約の強化**: URL入力のみからの完全自動アーカイビング。
* **多言語対応**: UIの英語/日本語切り替え機能。
* **CMS化**: 編集作業をブラウザ上で行える管理画面の導入（現在はファイル直接編集）。
* **画像取得の自動化強化**: より多くのサイト形式に対応した汎用スクレイピングロジック。
* **GitHub Pages連携**: 自動デプロイによる公開フローの効率化。
* **ニュース自動収集**: ChatGPTやPerplexityなどのAIを活用した自動ニュース収集ワークフロー。
* **画像判定AI**: 車内/車外画像の自動判定による適切な画像選択。
---

## 10. 追加要求（これまでの運用要望の反映）
本節は2025-12-18〜2026-01-30の追加要望を反映し、既存仕様と矛盾する場合は本節を優先する。

### 10.1 対象国・データ範囲
* 国フィルタは「🌍世界版／日本／中国／インド／米国／欧州／論文」の**複数選択**方式とする。
* 「世界版」選択時はすべてのニュースを表示する。論文は `country=paper` として扱う。
* country は jp / cn / in / us / eu / paper を使用する。
* 日付ごとに対象国の有無を許容し、insights_data.js の analysis / ideas は国別に省略可能とする（例: 2025-12-23は日本のみ）。

### 10.2 画像表示・プレースホルダー
* 画像が取得できない、または端末側で読み込めない場合はプレースホルダー（`images/placeholder_tech.jpg`）に差し替え、画像中央に「イメージ画像」を表示する。
* 実画像のロード成功時は「イメージ画像」表示を消す（表示が残らないようにする）。
* 表示判定は unsplash / placeholder を含むURL、note に「※イメージ画像」が含まれる場合、または onerror 検知時を対象とする。
* 画像は車室内装（ダッシュボード、シート、センターコンソール等）を優先する。
* `image.thum.io` や `googleusercontent.com` などの外部サービス経由画像は使用せず、直接URLまたはプレースホルダーを使用する。

### 10.3 画像レビュー運用
* review_interior.html で新旧画像を並列表示し、差し替え候補を選択できるようにする。
* file:// で開いた場合はローカルJSON読み込みボタンを使用し、または python -m http.server で開く。
* review_data.json の selected と note を反映し、apply_selected_images.py で news_data.js の img を一括更新する。

### 10.4 Excel追加のフィルタ条件とタグ付け
* search_results.xlsx から追加する場合、指定条件は LLM判定=対象、画像判定=あり、画像URL が空欄でないこと。
* キーワードタグはExcelの「関連キーワード」を使用せず、**タイトル・概要から日本語で具体的なタグを付与**する。
  * 良い例: `["LG", "OLED", "ディスプレイ", "車載", "CES2026"]`
  * 悪い例: `["interior", "car"]`
* URL と タイトル の整合性を確認し、国が未設定の場合は指定国（例: 日本）に合わせる。

### 10.5 キャッシュ対策
* news_data.js / insights_data.js の読み込みにバージョンパラメータを付与し、更新時にキャッシュ回避できるようにする（例: news_data.js?v=YYYYMMDD）。
* 更新が反映されない場合の手順としてハードリロードも記載する。

### 10.6 企画アイデア画像
* 企画アイデア画像は一旦ダミーを使用し、後で Antigravity で差し替える運用とする。

### 10.7 NEWバッジ表示
* 最新のニュース追加日（例: 2026-01-28）のニュースのみに「NEW」バッジを表示する。
* バッジは赤色グラデーション背景、白文字で画像左上（top: 6px, left: 6px）に配置する。
* パルスアニメーションで視認性を向上させる。
* 国名バッジとの重なりを避けるため、NEWバッジがある場合は国名バッジを下に配置する。
* 考察・アイデアセクションの日付に2026-01-06を含むエントリにも「NEW」バッジを表示する。

### 10.8 IDバッジ表示位置
* 記事IDバッジ（例: jp107）は画像内ではなく、カードフッターの出典（source）横に表示する。
* フォントサイズは小さめ（10px程度）とし、アクセント色で表示する。

### 10.9 URL・リンク検証
* 新規ニュース追加時は、追加後にURLアクセスチェックを行う。
* 404/403エラーまたは接続エラーのURLは削除または代替URLに差し替える。
* Bingニュースリダイレクト（`bing.com/news/apiclick`）は使用せず、直接URLを使用する。
* URLが途中で切れている（例: `https://www.g`）記事は削除する。

### 10.10 タグクリック検索
* ニュースカードのタグをクリックすると、そのキーワードで検索が実行される。
* 検索フィールドにキーワードが自動入力され、フィルタリングが適用される。

### 10.11 アクセスカウンター
* ヘッダーに「総アクセス数」と「本日のアクセス数」を表示する。
* カウントは端末（localStorage）で管理する。
* 日別データは**30日保持**する。
* JST固定で今日/昨日を算出する。
* 総アクセス数・本日アクセス数は**1端末1日1回**だけ増える。
* 記事閲覧数は**1端末1記事1日1回**のみ増える（記事クリックまたは5秒ホバーで加算）。

### 10.12 企画アイデア表示制限
* 初期表示は**最新1回分**のみとする。
* ページ下部に「もっと見る」ボタンを表示し、クリックで追加分を読み込む。
* 処理負荷軽減と初期表示速度向上のため。

### 10.13 考察・アイデア生成プロンプト
* 生成用プロンプトテンプレートは `.agent/prompts/insights_generation_prompt.md` に保存する。
* AIへの指示時にこのプロンプトを参照して一貫した出力形式を維持する。
* 画像生成プロンプトのテンプレートも同ファイルに含める。

### 10.14 ランキング・閲覧数
* 記事閲覧数はローカルでカウントし、ランキングに反映する。
* 集計はいいね×3＋コメント×2＋閲覧で総合順位を算出する。
* ランキングは地域変更時に自動再計算し、更新ボタン不要で反映する。

### 10.15 NEW更新ルール
* NEW表示は `NEW_DATE_RANGE_OVERRIDE` の日付に一致する記事・考察・アイデアのみ付与する。
* ニュース追加時は**今回追加分のみNEW**とし、前回分のNEWは外す。
* ニュースはデフォルトで**NEW対象が優先表示**される。

### 10.16 ランキング表示条件
* 論文タブ選択時はニュースランキングを非表示。
* 世界版/国別が選択中のときは論文ランキングを非表示。
* お気に入り表示中はニュース・論文ランキングとも非表示。
* 初期表示はトップ3件のみ表示し、展開で全件を表示。

### 10.17 お気に入り・共有
* お気に入り画面ではCSV出力とメール共有（mailto）を提供する。
* メール共有はHTML整形を試みるが、クライアントによっては生HTML表示になる可能性がある。
* お気に入り表示中は考察の表示を省略する。

### 10.18 画面内ナビゲーション
* 画面右下のクイックナビで「トップ / ニュース / 考察 / 企画アイデア」へジャンプできる。

### 10.19 JST固定
* 今日/昨日の判定、日別アクセスのキーは**JST固定**で算出する。

### 10.20 論文の扱い
* 論文は `country=paper` としてニュース同様に表示する。
* 論文には考察・企画アイデアは不要。
