<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂÜÖË£ÖË£ΩÂìÅ„Éá„Ç§„É™„Éº„Éã„É•„Éº„Çπ</title>
    <meta name="description" content="‰∏ñÁïå„ÅÆËá™ÂãïËªäÂÜÖË£Ö„ÉªHMI„Éª„Ç≥„ÇØ„Éî„ÉÉ„Éà„Éà„É¨„É≥„Éâ„Çí„Éï„Ç£„É´„Çø„É™„É≥„Ç∞ÂèØËÉΩ„Å™„Éã„É•„Éº„Çπ„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Åß„ÅäÂ±ä„Åë„ÄÇ">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --bg: #050a12;
            --panel: rgba(16, 22, 35, 0.88);
            --muted: #9aa4b8;
            --text: #e9edf5;
            --accent: #7df1c2;
            --accent-2: #6fa7ff;
            --accent-3: #ff8f6f;
            --accent-4: #c79dff;
            --border: rgba(255, 255, 255, 0.08);
            --shadow: 0 18px 50px rgba(0, 0, 0, 0.38);
            --radius: 18px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Manrope', 'Noto Sans JP', system-ui, sans-serif;
            background: radial-gradient(circle at 18% 12%, rgba(125, 241, 194, 0.06), transparent 30%),
                radial-gradient(circle at 82% 8%, rgba(111, 167, 255, 0.08), transparent 35%),
                radial-gradient(circle at 50% 95%, rgba(199, 157, 255, 0.05), transparent 25%), var(--bg);
            color: var(--text);
            line-height: 1.7;
            min-height: 100vh;
            padding: 24px 20px 100px;
        }

        header {
            max-width: 1400px;
            margin: 0 auto 20px;
            padding: 24px;
            border: 1px solid var(--border);
            background: linear-gradient(120deg, rgba(125, 241, 194, 0.06), rgba(111, 167, 255, 0.06));
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        h1 {
            font-size: clamp(22px, 3.5vw, 32px);
            margin-bottom: 6px;
            background: linear-gradient(135deg, var(--text), var(--accent-2));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .lead {
            color: var(--muted);
            font-size: 14px;
        }

        /* Filters */
        .filters {
            max-width: 1400px;
            margin: 0 auto 20px;
            padding: 20px;
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: var(--radius);
        }

        .filter-row {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 16px;
            align-items: center;
        }

        .filter-row:last-child {
            margin-bottom: 0;
        }

        .filter-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--muted);
            min-width: 80px;
        }

        .filter-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            flex: 1;
        }

        .tag-filter-container {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
            min-width: 0;
        }

        .tag-chips {
            flex-wrap: nowrap;
            overflow-x: auto;
            overflow-y: hidden;
            max-height: 34px;
            scrollbar-width: none;
            min-width: 0;
        }

        .tag-chips::-webkit-scrollbar {
            display: none;
        }

        .tag-chips.expanded {
            flex-wrap: wrap;
            max-height: none;
            overflow: visible;
        }

        .tag-toggle {
            white-space: nowrap;
            flex: 0 0 auto;
        }

        .tag-chips .chip {
            flex: 0 0 auto;
            white-space: nowrap;
        }

        /* Region Badge - replaces emoji icons for better compatibility */
        .region-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 4px 12px;
            margin-right: 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 700;
            color: #fff;
            vertical-align: middle;
        }

        .region-badge.world {
            background: linear-gradient(135deg, #7df1c2, #6fa7ff);
            color: #0c1224;
        }

        .region-badge.jp {
            background: linear-gradient(135deg, #ff6b6b, #ffd93d);
            color: #0c1224;
        }

        .region-badge.cn {
            background: linear-gradient(135deg, #de2910, #ffde00);
            color: #fff;
        }

        .region-badge.in {
            background: linear-gradient(135deg, #ff9933, #138808);
            color: #fff;
        }

        .region-badge.us {
            background: linear-gradient(135deg, #3c3b6e, #b22234);
            color: #fff;
        }

        .region-badge.eu {
            background: linear-gradient(135deg, #003399, #ffcc00);
            color: #fff;
        }

        /* World/Globe icon using image */
        .globe-icon {
            display: inline-block;
            width: 18px;
            height: 18px;
            background: url('images/globe_icon.png') no-repeat center center;
            background-size: contain;
            vertical-align: middle;
            margin-right: 6px;
        }

        /* Title globe icon (larger) */
        .title-globe-icon {
            height: 32px;
            width: auto;
            vertical-align: middle;
            margin-right: 12px;
            object-fit: contain;
        }

        .chip {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            border: 1px solid var(--border);
            background: rgba(255, 255, 255, 0.03);
            color: var(--muted);
            transition: all 0.2s ease;
            user-select: none;
        }

        .chip:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .chip.active {
            background: linear-gradient(135deg, var(--accent), var(--accent-2));
            color: #0c1224;
            border-color: transparent;
        }

        .chip .new-count {
            margin-left: 6px;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 700;
            border: 1px solid rgba(255, 120, 120, 0.6);
            color: #ff8a8a;
            background: rgba(255, 120, 120, 0.12);
        }

        .chip .new-count.hidden {
            display: none;
        }

        .chip.active .new-count {
            color: #0c1224;
            background: rgba(255, 255, 255, 0.7);
            border-color: transparent;
        }

        .chip.country-jp.active {
            background: linear-gradient(135deg, #ff6b6b, #ffd93d);
        }

        .chip.country-cn.active {
            background: linear-gradient(135deg, #7df1c2, #6fa7ff);
        }

        .chip.country-in.active {
            background: linear-gradient(135deg, #ff9933, #138808);
        }

        .chip.country-us.active {
            background: linear-gradient(135deg, #3c3b6e, #b22234);
        }

        .chip.country-eu.active {
            background: linear-gradient(135deg, #003399, #ffcc00);
        }

        .chip.country-world.active {
            background: linear-gradient(135deg, #c79dff, #6fa7ff);
        }

        /* Image-based Flags */
        .flag-icon {
            height: 18px;
            width: auto;
            display: inline-block;
            vertical-align: middle;
            margin-right: 6px;
            object-fit: contain;
            border-radius: 2px;
        }

        /* Background-based flag icons (for span elements) */
        .flag-icon[class*="flag-"] {
            width: 24px;
            height: 16px;
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center;
        }

        .flag-jp {
            background-image: url('images/icon_jp.png');
        }

        .flag-cn {
            background-image: url('images/icon_cn.png');
        }

        .flag-in {
            background-image: url('images/icon_in.png');
        }

        .flag-us {
            background-image: url('images/icon_us.png');
        }

        .flag-eu {
            background-image: url('images/icon_eu.png');
        }

        .date-inputs {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }

        .date-inputs input {
            padding: 8px 12px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: rgba(255, 255, 255, 0.05);
            color: var(--text);
            font-size: 13px;
        }

        .date-inputs span {
            color: var(--muted);
            font-size: 13px;
        }

        .stats {
            font-size: 13px;
            color: var(--muted);
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border);
        }

        .stats strong {
            color: var(--accent);
        }

        /* Grid */
        .grid {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
            gap: 16px;
        }

        .card {
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: transform 0.2s ease, border-color 0.2s ease, opacity 0.3s ease;
        }

        .card:hover {
            transform: translateY(-3px);
            border-color: rgba(125, 241, 194, 0.3);
        }

        .card.hidden {
            display: none;
        }

        .thumb {
            position: relative;
            padding-top: 52%;
            overflow: hidden;
            background: linear-gradient(135deg, #1a2332, #0d1520);
        }

        .thumb img {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.88;
        }

        .card:hover .thumb img {
            opacity: 1;
        }

        .fallback-overlay {
            position: absolute;
            inset: 0;
            display: none;
            align-items: center;
            justify-content: center;
            color: #e3e9f4;
            font-weight: 800;
            font-size: 16px;
            background: linear-gradient(135deg, rgba(76, 195, 255, 0.14), rgba(13, 21, 32, 0.9));
            border: 1px dashed rgba(255, 255, 255, 0.12);
            border-radius: 10px;
            text-shadow: 0 1px 4px rgba(0, 0, 0, 0.5);
            z-index: 2;
        }

        .country-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            padding: 4px 10px;
            background: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(6px);
            border-radius: 8px;
            font-size: 13px;
        }

        .image-note {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            color: #fff;
            font-size: 14px;
            font-weight: 700;
            padding: 8px 16px;
            text-align: center;
            border-radius: 8px;
            pointer-events: none;
            border: 1px solid rgba(255, 255, 255, 0.2);
            white-space: nowrap;
            z-index: 2;
        }


        /* New Badge */
        .new-badge {
            position: absolute;
            top: 6px;
            left: 6px;
            padding: 4px 10px;
            background: linear-gradient(135deg, #ff4d4d, #ff6b6b);
            border-radius: 8px;
            font-size: 11px;
            font-weight: 700;
            color: #fff;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 8px rgba(255, 77, 77, 0.4);
            animation: pulse 2s infinite;
            z-index: 4;
        }

        /* Country Badge - positioned below New badge when present */
        .country-badge {
            position: absolute;
            top: 6px;
            left: 6px;
            padding: 4px 10px;
            background: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(6px);
            border-radius: 8px;
            font-size: 11px;
            font-weight: 600;
            color: #fff;
            z-index: 2;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* When New badge is present, move country badge down */
        .thumb .new-badge+.country-badge {
            top: 34px;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }
        }

        .idea-new-badge {
            display: inline-block;
            padding: 3px 8px;
            background: linear-gradient(135deg, #ff4d4d, #ff6b6b);
            border-radius: 6px;
            font-size: 10px;
            font-weight: 700;
            color: #fff;
            margin-left: 10px;
            text-transform: uppercase;
            animation: pulse 2s infinite;
        }

        .date-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 4px 10px;
            background: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(6px);
            border-radius: 8px;
            font-size: 11px;
            color: var(--muted);
        }

        /* ID Badge moved to source area */
        .id-badge-thumb {
            display: none;
            /* Hide the old one in thumb */
        }

        .id-badge {
            display: inline-block;
            padding: 2px 8px;
            background: rgba(125, 241, 194, 0.15);
            border: 1px solid rgba(125, 241, 194, 0.3);
            border-radius: 6px;
            font-size: 10px;
            font-weight: 600;
            color: var(--muted);
            font-family: monospace;
        }

        .content {
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .title {
            font-size: 16px;
            font-weight: 700;
            line-height: 1.4;
        }

        .desc {
            color: #b8c4d6;
            font-size: 13px;
            line-height: 1.6;
        }

        .card-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 4px;
        }

        .card-tag {
            padding: 3px 8px;
            border-radius: 6px;
            font-size: 10px;
            background: rgba(125, 241, 194, 0.12);
            color: var(--accent);
            border: 1px solid rgba(125, 241, 194, 0.2);
        }

        .actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 8px;
        }

        .btn {
            padding: 8px 14px;
            border-radius: 10px;
            font-weight: 700;
            text-decoration: none;
            font-size: 12px;
            color: #0c1224;
            background: linear-gradient(135deg, var(--accent), var(--accent-2));
            box-shadow: 0 6px 20px rgba(125, 241, 194, 0.2);
            transition: transform 0.15s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .source {
            font-size: 11px;
            color: var(--muted);
        }

        /* Empty state */
        .empty-state {
            max-width: 1400px;
            margin: 60px auto;
            text-align: center;
            color: var(--muted);
        }

        .empty-state h3 {
            font-size: 20px;
            margin-bottom: 10px;
            color: var(--text);
        }

        @media (max-width: 700px) {
            body {
                padding: 16px 12px 80px;
            }

            .filter-row {
                flex-direction: column;
                align-items: flex-start;
            }

            .filter-label {
                min-width: auto;
                margin-bottom: 4px;
            }

            .grid {
                grid-template-columns: 1fr;
            }
        }

        /* Analysis & Ideas Section */
        .analysis-section {
            max-width: 1400px;
            margin: 48px auto 0;
            padding: 32px;
            background: linear-gradient(135deg, rgba(125, 241, 194, 0.05), rgba(111, 167, 255, 0.05));
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius);
            position: relative;
        }

        .section-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--text);
        }

        .section-icon {
            font-size: 24px;
        }

        .analysis-text {
            color: #cfd6e3;
            font-size: 15px;
            line-height: 1.8;
        }

        .ideas-section {
            max-width: 1400px;
            margin: 32px auto 60px;
            padding: 32px;
            background: linear-gradient(135deg, rgba(125, 241, 194, 0.02), rgba(111, 167, 255, 0.02));
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius);
        }

        .target-badge {
            display: inline-block;
            padding: 4px 10px;
            background: rgba(125, 241, 194, 0.15);
            border: 1px solid rgba(125, 241, 194, 0.3);
            border-radius: 6px;
            font-size: 11px;
            color: var(--accent);
            margin-bottom: 16px;
        }

        .idea-card {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 24px;
            margin-top: 16px;
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }

        .idea-image-wrapper {
            flex-shrink: 0;
            width: 320px;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: #000;
        }

        .idea-img {
            width: 100%;
            height: auto;
            display: block;
        }

        .idea-content {
            flex: 1;
            min-width: 0;
        }

        .idea-header {
            display: flex;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .idea-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 24px;
            height: 24px;
            background: var(--accent);
            border-radius: 6px;
            font-size: 12px;
            font-weight: 700;
            color: #0c1224;
            margin-right: 12px;
            margin-top: 2px;
            /* Align with text */
        }

        .idea-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--text);
            line-height: 1.5;
        }

        .idea-desc {
            color: var(--muted);
            font-size: 14px;
            line-height: 1.7;
            margin-top: 8px;
        }

        @media (max-width: 700px) {
            .idea-card {
                flex-direction: column;
            }

            .idea-image-wrapper {
                width: 100%;
            }
        }

        /* Summary Toggle Styles */
        .summary-wrapper {
            margin-top: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .summary-btn {
            background: none;
            border: none;
            color: var(--accent);
            cursor: pointer;
            font-size: 0.85rem;
            padding: 0;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            transition: color 0.2s;
        }

        .summary-btn:hover {
            text-decoration: underline;
        }

        .summary-btn::after {
            content: '‚ñº';
            font-size: 0.7em;
            transition: transform 0.3s;
        }

        .summary-btn.open::after {
            transform: rotate(180deg);
        }

        .summary-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.6;
            margin-top: 0;
            opacity: 0;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 4px;
        }

        .summary-content.open {
            margin-top: 0.5rem;
            padding: 0.75rem;
            opacity: 1;
            /* max-height is set via JS */
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-top: 24px;
        }

        .analysis-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 16px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .analysis-card:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
        }

        .analysis-card.region-jp {
            border-top: 3px solid #ff4d4d;
        }

        .analysis-card.region-cn {
            border-top: 3px solid #ffcc00;
        }

        .analysis-card.region-in {
            border-top: 3px solid #ff9933;
        }

        .analysis-card.region-us {
            border-top: 3px solid #3c3b6e;
        }

        .analysis-card.region-eu {
            border-top: 3px solid #003399;
        }

        .flag-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 12px;
        }

        .flag-emoji {
            font-size: 32px;
            line-height: 1;
        }

        .country-label {
            font-size: 18px;
            font-weight: 700;
            color: var(--text);
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .analysis-text-body {
            font-size: 15px;
            line-height: 1.8;
            color: #d0d0d0;
            text-align: justify;
        }

        .analysis-text-body strong {
            color: #fff;
            background: rgba(125, 241, 194, 0.15);
            padding: 0 4px;
            border-radius: 4px;
            font-weight: 600;
        }

        /* Improved Ideas Layout */
        .region-section {
            margin-bottom: 40px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .region-title-wrapper {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .region-title-text {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text);
            letter-spacing: 0.05em;
        }

        .ideas-grid {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .idea-card {
            background: rgba(30, 34, 45, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            overflow: hidden;
            display: flex;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            align-items: stretch;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .idea-card:hover {
            transform: translateY(-4px);
            border-color: var(--accent);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3);
            background: rgba(30, 34, 45, 0.8);
        }

        .idea-image-wrapper {
            width: 360px;
            position: relative;
            min-height: 240px;
            border: none;
            background: #000;
        }

        .idea-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            transition: transform 0.5s ease;
        }

        .idea-card:hover .idea-img {
            transform: scale(1.03);
        }

        .idea-content {
            padding: 32px;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .idea-header {
            display: flex;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .idea-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--accent), #4facfe);
            color: #000;
            font-weight: 900;
            border-radius: 10px;
            width: 32px;
            height: 32px;
            font-size: 16px;
            margin-right: 16px;
            flex-shrink: 0;
            box-shadow: 0 4px 10px rgba(125, 241, 194, 0.3);
        }

        .idea-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: #fff;
            line-height: 1.3;
            margin-top: -4px;
            /* Optical alignment with number */
        }

        .idea-desc {
            color: #b0b8c4;
            font-size: 15px;
            line-height: 1.8;
            margin-top: 0;
        }

        /* Distinct Region Styles */
        .region-section.jp {
            border-left: 4px solid #ff4d4d;
            background: linear-gradient(90deg, rgba(255, 77, 77, 0.05), transparent);
        }

        .region-section.cn {
            border-left: 4px solid #ffcc00;
            background: linear-gradient(90deg, rgba(255, 204, 0, 0.05), transparent);
        }

        .region-section.in {
            border-left: 4px solid #ff9933;
            background: linear-gradient(90deg, rgba(255, 153, 51, 0.05), transparent);
        }

        .region-section.us {
            border-left: 4px solid #3c3b6e;
            background: linear-gradient(90deg, rgba(60, 59, 110, 0.05), transparent);
        }

        .region-section.eu {
            border-left: 4px solid #003399;
            background: linear-gradient(90deg, rgba(0, 51, 153, 0.05), transparent);
        }

        @media (max-width: 900px) {
            .idea-card {
                flex-direction: column;
            }

            .idea-image-wrapper {
                width: 100%;
                height: 240px;
            }

            .idea-content {
                padding: 24px;
            }

            .idea-title {
                font-size: 1.2rem;
            }
        }


        /* Social Actions (Like & Comment) */
        .social-actions {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-top: 16px;
            padding-top: 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .action-btn {
            background: rgba(255, 255, 255, 0.05);
            border: none;
            border-radius: 20px;
            color: #b0b8c4;
            padding: 6px 14px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .action-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .action-btn.liked {
            color: #ff4d4d;
            background: rgba(255, 77, 77, 0.1);
        }

        .action-btn.active-comment {
            color: #4facfe;
            background: rgba(79, 172, 254, 0.1);
        }

        .comment-section {
            display: none;
            margin-top: 12px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 12px;
        }

        .comment-section.open {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .comment-list {
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 12px;
            font-size: 13px;
        }

        .comment-item {
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .comment-user {
            font-weight: bold;
            color: var(--accent);
            font-size: 11px;
            margin-bottom: 2px;
        }

        .comment-text {
            color: #ddd;
            line-height: 1.4;
        }

        .comment-input-area {
            display: flex;
            gap: 8px;
        }

        .comment-input {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 8px;
            color: #fff;
            font-size: 13px;
        }

        .comment-submit {
            background: var(--accent);
            color: #000;
            border: none;
            border-radius: 8px;
            padding: 0 12px;
            font-weight: bold;
            cursor: pointer;
        }


        /* Social Actions merged into Actions */
        .actions {
            margin-top: auto;
            padding-top: 16px;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            /* Changed from space-between */
            gap: 12px;
            flex-wrap: wrap;
        }

        .action-btn {
            background: rgba(255, 255, 255, 0.05);
            /* slightly lighter */
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            color: #b0b8c4;
            padding: 6px 12px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
            height: 36px;
            /* Match 'Read Article' button height approx */
        }

        .action-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            color: #fff;
        }

        .source {
            margin-left: auto;
            /* Push to right */
            font-size: 0.85rem;
            color: #666;
        }

        /* Comment Section Adjustments */
        .comment-item {
            position: relative;
        }

        .delete-btn {
            position: absolute;
            right: 0;
            top: 0;
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            font-size: 14px;
            padding: 4px;
        }

        .delete-btn:hover {
            color: #ff4d4d;
        }
    </style>
</head>

<body>
    <header>
        <h1><img id="titleIcon" class="title-globe-icon" src="images/icon_world.png" alt="Âú∞Âüü">ÂÜÖË£ÖË£ΩÂìÅ„Éá„Ç§„É™„Éº„Éã„É•„Éº„Çπ</h1>
        <p class="lead">‰∏ñÁïå„ÅÆËá™ÂãïËªäÂÜÖË£Ö„ÉªHMI„Éª„Ç≥„ÇØ„Éî„ÉÉ„Éà„Éà„É¨„É≥„Éâ„Çí„Éï„Ç£„É´„Çø„É™„É≥„Ç∞ÂèØËÉΩ„Å™„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Åß„ÅäÂ±ä„Åë</p>
        <div class="access-counter"
            style="margin-top:12px; font-size:12px; color:var(--muted); display:flex; gap:20px;">
            <span>üìä Á∑è„Ç¢„ÇØ„Çª„ÇπÊï∞: <strong id="totalVisits" style="color:var(--accent);">-</strong></span>
            <span>üìÖ Êú¨Êó•: <strong id="todayVisits" style="color:var(--accent-2);">-</strong></span>
        </div>
    </header>

    <div class="filters">
        <div class="filter-row">
            <span class="filter-label">üåê Âú∞Âüü</span>
            <div class="filter-chips" id="countryFilters">
                <span class="chip country-world active" data-country="world"><img src="images/icon_world.png"
                        class="flag-icon" alt="World"> ‰∏ñÁïåÁâà<span class="new-count" data-country="world"></span></span>
                <span class="chip country-jp" data-country="jp"><span class="flag-icon flag-jp"></span>Êó•Êú¨<span
                        class="new-count" data-country="jp"></span></span>
                <span class="chip country-cn" data-country="cn"><span class="flag-icon flag-cn"></span>‰∏≠ÂõΩ<span
                        class="new-count" data-country="cn"></span></span>
                <span class="chip country-in" data-country="in"><span class="flag-icon flag-in"></span>„Ç§„É≥„Éâ<span
                        class="new-count" data-country="in"></span></span>
                <span class="chip country-us" data-country="us"><span class="flag-icon flag-us"></span>Á±≥ÂõΩ<span
                        class="new-count" data-country="us"></span></span>
                <span class="chip country-eu" data-country="eu"><span class="flag-icon flag-eu"></span>Ê¨ßÂ∑û<span
                        class="new-count" data-country="eu"></span></span>
            </div>
        </div>
        <div class="filter-row">
            <span class="filter-label">üè∑Ô∏è „Ç∏„É£„É≥„É´</span>
            <div class="tag-filter-container">
                <div class="filter-chips tag-chips" id="tagFilters">
                    <span class="chip active" data-tag="all">„Åô„Åπ„Å¶</span>
                </div>
                <button class="chip tag-toggle" id="tagToggle" type="button" aria-expanded="false">„ÇÇ„Å£„Å®Ë¶ã„Çã</button>
            </div>
        </div>
        <div class="filter-row">
            <span class="filter-label">üìÖ Êó•‰ªò</span>
            <div class="date-inputs">
                <input type="date" id="dateFrom" value="">
                <span>„Äú</span>
                <input type="date" id="dateTo" value="">
            </div>
        </div>
        <div class="filter-row">
            <span class="filter-label">üîç Ê§úÁ¥¢</span>
            <input type="text" id="searchInput" class="search-input" placeholder="„Ç≠„Éº„ÉØ„Éº„ÉâÊ§úÁ¥¢..."
                style="padding: 8px 12px; border-radius: 10px; border: 1px solid var(--border); background: rgba(255, 255, 255, 0.05); color: var(--text); font-size: 13px; width: 240px;">
            <select id="sortOrder"
                style="padding: 8px 12px; border-radius: 10px; border: 1px solid var(--border); background: #1e222d; color: var(--text); font-size: 13px; margin-left: 12px;">
                <option value="date-desc" style="background: #1e222d; color: #fff;">Êñ∞„Åó„ÅÑÈ†Ü</option>
                <option value="date-asc" style="background: #1e222d; color: #fff;">Âè§„ÅÑÈ†Ü</option>
                <option value="country" style="background: #1e222d; color: #fff;">ÂõΩÈ†ÜÔºàÊó•Êú¨‚Üí‰∏≠ÂõΩ‚Üí„Ç§„É≥„Éâ‚ÜíÁ±≥ÂõΩ‚ÜíÊ¨ßÂ∑ûÔºâ</option>
                <option value="likes-desc" style="background: #1e222d; color: #fff;">„ÅÑ„ÅÑ„Å≠È†Ü</option>
                <option value="comments-desc" style="background: #1e222d; color: #fff;">„Ç≥„É°„É≥„ÉàÊï∞È†Ü</option>
            </select>
        </div>
        <div class="stats">Ë°®Á§∫‰∏≠: <strong id="visibleCount">0</strong> / <span id="totalCount">0</span> ‰ª∂</div>
    </div>


    <section class="grid" id="newsGrid"></section>
    <div style="text-align: center; margin: 2rem 0;">
        <button id="loadMoreBtn" onclick="loadMore()" class="btn" style="display: none;">„ÇÇ„Å£„Å®Ë¶ã„Çã</button>
    </div>



    <div id="insightsContainer"></div>


    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, runTransaction, doc, getDoc, setDoc, updateDoc, arrayUnion, onSnapshot, increment, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCEKRdUl_mOYjBGLKY35IFWLAHEyDH3Og8",
            authDomain: "daily-news-9a418.firebaseapp.com",
            projectId: "daily-news-9a418",
            storageBucket: "daily-news-9a418.firebasestorage.app",
            messagingSenderId: "965463819558",
            appId: "1:965463819558:web:89e6c8907aec51155bede7",
            measurementId: "G-L82JZQYM25"
        };

        let db;
        try {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            console.log("Firebase Connected");
            // Load all interactions for sorting
            loadInteractions();
            // Update access counter
            updateAccessCounter();
        } catch (e) {
            console.error("Firebase Connection Failed:", e);
        }

        // Global interactions data for sorting
        window.interactionsData = {};

        async function loadInteractions() {
            if (!db) return;
            try {
                const snapshot = await getDocs(collection(db, "interactions"));
                snapshot.forEach(docSnap => {
                    const data = docSnap.data();
                    window.interactionsData[docSnap.id] = {
                        likes: data.likes || 0,
                        comments: (data.comments || []).length
                    };
                });
                console.log("Interactions loaded:", Object.keys(window.interactionsData).length);
            } catch (e) {
                console.error("Failed to load interactions:", e);
            }
        }

        // „Ç¢„ÇØ„Çª„Çπ„Ç´„Ç¶„É≥„Çø„ÉºÔºàFirebaseÈÄ£Êê∫Ôºâ
        async function updateAccessCounter() {
            try {
                const today = new Date().toISOString().split('T')[0];
                const counterRef = doc(db, 'pageStats', 'accessCounter');

                // „Éà„É©„É≥„Ç∂„ÇØ„Ç∑„Éß„É≥„Åß„Ç´„Ç¶„É≥„Çø„Éº„Çí„Ç§„É≥„ÇØ„É™„É°„É≥„Éà
                await runTransaction(db, async (transaction) => {
                    const docSnap = await transaction.get(counterRef);
                    if (!docSnap.exists()) {
                        transaction.set(counterRef, {
                            total: 1,
                            daily: { [today]: 1 },
                            lastUpdated: today
                        });
                    } else {
                        const data = docSnap.data();
                        const newTotal = (data.total || 0) + 1;
                        const daily = data.daily || {};
                        daily[today] = (daily[today] || 0) + 1;

                        // Âè§„ÅÑÊó•‰ªò„ÅÆ„Éá„Éº„Çø„ÇíÂâäÈô§Ôºà7Êó•‰ª•‰∏äÂâçÔºâ
                        const weekAgo = new Date();
                        weekAgo.setDate(weekAgo.getDate() - 7);
                        Object.keys(daily).forEach(date => {
                            if (new Date(date) < weekAgo) delete daily[date];
                        });

                        transaction.update(counterRef, {
                            total: newTotal,
                            daily: daily,
                            lastUpdated: today
                        });
                    }
                });

                // ÊúÄÊñ∞„ÅÆ„Ç´„Ç¶„É≥„Éà„ÇíÂèñÂæó„Åó„Å¶Ë°®Á§∫
                const snapshot = await getDoc(counterRef);
                if (snapshot.exists()) {
                    const data = snapshot.data();
                    document.getElementById('totalVisits').textContent = (data.total || 0).toLocaleString();
                    document.getElementById('todayVisits').textContent = ((data.daily && data.daily[today]) || 0).toLocaleString();
                }
                console.log("Access counter updated");
            } catch (error) {
                console.log('Access counter error:', error.message);
                document.getElementById('totalVisits').textContent = '-';
                document.getElementById('todayVisits').textContent = '-';
            }
        }

        // Live Listeners Registry
        const unsubscribes = {};
        const liveElements = {}; // { btnLike, btnComment, commentList, lastData }


        window.deleteComment = async (itemId, commentIndex) => {
            if (!confirm('„Ç≥„É°„É≥„Éà„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) return;

            const ref = getItemRef(itemId);

            try {
                // To delete from array, we normally need the EXACT object.
                // But here we only have index. Firestore arrayRemove requires exact object match.
                // So we must: Read -> Modify -> Write.

                await runTransaction(db, async (transaction) => {
                    const docSnap = await transaction.get(ref);
                    if (!docSnap.exists()) return;

                    const data = docSnap.data();
                    const comments = data.comments || [];

                    if (commentIndex >= 0 && commentIndex < comments.length) {
                        const newComments = [...comments];
                        newComments.splice(commentIndex, 1);
                        transaction.update(ref, { comments: newComments });
                    }
                });

                // UI update will happen via snapshot
            } catch (e) {
                console.error("Delete Error", e);
                alert("ÂâäÈô§„Å´Â§±Êïó„Åó„Åæ„Åó„Åü");
            }
        };

        // Helper to get doc ref
        const getItemRef = (itemId) => doc(db, "interactions", itemId);

        const renderItem = (itemId) => {
            const els = liveElements[itemId];
            const data = els.lastData;
            if (!els || !data) return;

            // Update Like Count
            if (els.btnLike) {
                const countSpan = els.btnLike.querySelector('.count');
                if (countSpan) countSpan.textContent = data.likes || 0;
            }
            // Update Comment Count
            if (els.btnComment) {
                const countSpan = els.btnComment.querySelector('.count');
                const comments = data.comments || [];
                if (countSpan) countSpan.textContent = comments.length;
            }
            // Update Comment List
            if (els.commentList) {
                const comments = data.comments || [];
                els.commentList.innerHTML = comments.map((c, i) => `
                        <div class="comment-item">
                            <div class="comment-user">${c.user || 'Guest'} <span style="font-weight:normal;color:#888;font-size:10px;margin-left:6px;">${c.date || ''}</span></div>
                            <div class="comment-text">${c.text}</div>
                            <button class="delete-btn" onclick="deleteComment('${itemId}', ${i})">√ó</button>
                        </div>
                     `).join('');
            }
        };

        // Listen for updates on an item (Realtime)
        window.subscribeItem = (itemId, btnLike, btnComment, commentList) => {
            if (!db) return;

            // Register/Update elements
            if (!liveElements[itemId]) liveElements[itemId] = {};
            if (btnLike) liveElements[itemId].btnLike = btnLike;
            if (btnComment) liveElements[itemId].btnComment = btnComment;
            if (commentList) liveElements[itemId].commentList = commentList;

            // If we already have data, render immediately to cover the newly added element
            if (liveElements[itemId].lastData) {
                renderItem(itemId);
            }

            if (unsubscribes[itemId]) return;

            unsubscribes[itemId] = onSnapshot(getItemRef(itemId), (docSnap) => {
                if (docSnap.exists()) {
                    liveElements[itemId].lastData = docSnap.data();
                    renderItem(itemId);
                } else {
                    liveElements[itemId].lastData = { likes: 0, comments: [] };
                    renderItem(itemId);
                }
            });
        };
        window.toggleLike = async (itemId, btn) => {
            if (!db) return;

            // Check Local State for "Liked by me" visual (Local Storage)
            const storageKey = `liked_${itemId}`;
            const isLiked = localStorage.getItem(storageKey);

            const ref = getItemRef(itemId);

            try {
                // Optimistic UI - update class and count immediately
                btn.classList.toggle('liked');
                const countSpan = btn.querySelector('.count');
                const currentCount = parseInt(countSpan.textContent) || 0;
                const val = isLiked ? -1 : 1;
                countSpan.textContent = Math.max(0, currentCount + val);

                // Update DB
                // Ensure doc exists
                await setDoc(ref, { last_update: new Date() }, { merge: true });
                await updateDoc(ref, {
                    likes: increment(val)
                });

                if (isLiked) localStorage.removeItem(storageKey);
                else localStorage.setItem(storageKey, 'true');

            } catch (e) {
                console.error("Like Error", e);
                // Revert UI if error
                btn.classList.toggle('liked');
                const countSpan = btn.querySelector('.count');
                const currentCount = parseInt(countSpan.textContent) || 0;
                const val = isLiked ? 1 : -1;
                countSpan.textContent = Math.max(0, currentCount + val);
            }
        };

        window.toggleComments = (itemId, btn) => {
            const card = btn.closest('.card') || btn.closest('.idea-card');
            const section = card.querySelector('.comment-section');
            const commentList = section.querySelector('.comment-list');

            const isOpen = section.classList.toggle('open');
            btn.classList.toggle('active-comment');

            if (isOpen) {
                subscribeItem(itemId, null, null, commentList);
            }
        };

        window.submitComment = async (itemId, input) => {
            const text = input.value.trim();
            if (!text || !db) return;

            const ref = getItemRef(itemId);
            const newComment = {
                user: "Guest", // Replace with Auth name if available
                text: text,
                date: new Date().toLocaleDateString()
            };

            try {
                input.value = ""; // Clear input immediately

                // Ensure doc exists
                await setDoc(ref, { last_update: new Date() }, { merge: true });
                await updateDoc(ref, {
                    comments: arrayUnion(newComment)
                });
            } catch (e) {
                console.error("Comment Error", e);
                alert("„Ç≥„É°„É≥„ÉàÈÄÅ‰ø°„Å´Â§±Êïó„Åó„Åæ„Åó„Åü");
            }
        };

        // Initial Subscription for visible items (Lazy load preferred but simple for now)
        // We will hook this into the render loop implicitly by observing elements? 
        // Or simply wait for interaction.
        // For Counts to show initially, we need to subscribe or fetch.
        // Let's create an IntersectionObserver to subscribe when visible.

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const card = entry.target;
                    const btnLike = card.querySelector('.action-btn[onclick*="toggleLike"]'); // primitive selector
                    // Extract ID from onclick attribute... hacky but works without changing render logic
                    // onclick="toggleLike('jp1', this)"
                    if (btnLike) {
                        const match = btnLike.getAttribute('onclick').match(/'([^']+)'/);
                        if (match) {
                            const itemId = match[1];
                            const btnComment = card.querySelector('.btn-comment');
                            window.subscribeItem(itemId, btnLike, btnComment, null);

                            // Check "Liked" status
                            if (localStorage.getItem(`liked_${itemId}`)) {
                                btnLike.classList.add('liked');
                            }
                        }
                    }
                    observer.unobserve(card);
                }
            });
        }, { threshold: 0.1 });

        // Wait for DOM
        setTimeout(() => {
            document.querySelectorAll('.card, .idea-card').forEach(el => observer.observe(el));

            // Also observe new elements added later (Load More)
            const grid = document.getElementById('newsGrid');
            if (grid) {
                const mutObserver = new MutationObserver((muts) => {
                    muts.forEach(m => {
                        m.addedNodes.forEach(n => {
                            if (n.nodeType === 1) observer.observe(n);
                        });
                    });
                });
                mutObserver.observe(grid, { childList: true });
            }
        }, 1000);

    </script>

    <script src="news_data.js" defer></script>
    <script src="insights_data.js" defer></script>
    <script>
        let NEWS_DATA = [];
        let visibleLimit = 30;

        let NEW_DATE_RANGE = { start: null, end: null };

        // New????????????New?????
        function isNewContent(itemOrDate) {
            if (itemOrDate && typeof itemOrDate === "object") {
                if (itemOrDate.isNew === true) return true;
                if (itemOrDate.isNew === false) return false;
                const dateStr = itemOrDate.date;
                if (!dateStr || !NEW_DATE_RANGE.start) return false;
                return dateStr >= NEW_DATE_RANGE.start && dateStr <= NEW_DATE_RANGE.end;
            }
            const dateStr = itemOrDate;
            if (!dateStr || !NEW_DATE_RANGE.start) return false;
            return dateStr >= NEW_DATE_RANGE.start && dateStr <= NEW_DATE_RANGE.end;
        }

        function isNewInsightDate(dateLabel) {
            if (!dateLabel || !NEW_DATE_RANGE.start) return false;
            return dateLabel.includes(NEW_DATE_RANGE.start) || dateLabel.includes(NEW_DATE_RANGE.end);
        }

        function getNewCounts(data) {
            const counts = { world: 0, jp: 0, cn: 0, in: 0, us: 0, eu: 0 };
            if (!data) return counts;
            data.forEach(item => {
                if (!isNewContent(item)) return;
                counts.world += 1;
                if (counts[item.country] !== undefined) counts[item.country] += 1;
            });
            return counts;
        }

        function updateNewCountBadges() {
            const counts = getNewCounts(NEWS_DATA);
            document.querySelectorAll("#countryFilters .new-count").forEach(el => {
                const country = el.dataset.country;
                const count = counts[country] || 0;
                if (count > 0) {
                    el.textContent = `New ${count}`;
                    el.classList.remove("hidden");
                } else {
                    el.textContent = "";
                    el.classList.add("hidden");
                }
            });
        }

        function updateTitleIcon() {
            const iconEl = document.getElementById("titleIcon");
            if (!iconEl) return;
            let key = "world";
            if (!activeCountries.has("world") && activeCountries.size === 1) {
                const selected = [...activeCountries][0];
                if (selected) key = selected;
            }
            iconEl.src = TITLE_ICONS[key] || TITLE_ICONS.world;
        }

        function getLatestDate(data) {
            if (!data || data.length === 0) return null;
            return data.reduce((max, item) => item.date > max ? item.date : max, data[0].date);
        }

        function setNewDateRangeFromNews(data) {
            const latest = getLatestDate(data);
            if (latest) {
                NEW_DATE_RANGE = { start: latest, end: latest };
            }
        }


        const ALL_TAGS = [
            "„Çª„É≥„Çø„Éº„Ç≥„É≥„ÇΩ„Éº„É´", "„Ç§„É≥„Éë„Éç", "Âä†È£æ", "Êñ∞Á¥†Êùê", "Êñ∞ÊùêÊñô", "„Ç§„É´„Éü", "ÁÜ±„Éû„Éç", "„ÉØ„Ç§„É§„É¨„ÇπÂÖÖÈõª", "„Ç§„É≥„Çø„É©„ÇØ„ÉÜ„Ç£„Éñ", "Âø´ÈÅ©", "„Çª„É≥„Ç∑„É≥„Ç∞", "HMI", "ÂÖàÈÄ≤ÊäÄË°ì", "„Ç´„Çπ„Çø„Éû„Ç§„Ç∫",
            "ÂìÅË≥™", "„Ç¢„Éï„Çø„Éº", "OS", "ÂïÜÁî®Ëªä", "„Çπ„Éû„Éº„Éà„Éõ„Éº„É†ÈÄ£Êê∫", "„Çº„É≠„Ç∞„É©„Éì„ÉÜ„Ç£", "„Çµ„Çπ„ÉÜ„Éä„Éì„É™„ÉÜ„Ç£", "ÂçäÂ∞é‰Ωì", "„Çµ„Éó„É©„Ç§„ÉÅ„Çß„Éº„É≥", "„É©„Ç∞„Ç∏„É•„Ç¢„É™„Éº", "„Ç§„É≥„Éï„É©",
            "Â±Ö‰ΩèÊÄß", "Áâ©ÁêÜ„Ç≠„Éº", "3Âàó„Ç∑„Éº„Éà", "„Éï„Ç°„Éü„É™„Éº", "„Éá„Ç∂„Ç§„É≥", "„Ç¢„ÇØ„Çª„Çµ„É™", "„É™„Çµ„Ç§„ÇØ„É´", "LCA", "DX", "„Ç∑„Éß„Éº„Éï„Ç°„Éº", "Ë¶ãÂÆà„Çä", "„Ç¨„Ç∏„Çß„ÉÉ„Éà", "„Ç≥„É≥„Éë„ÇØ„Éà", "Ë≥™ÊÑü", "„É¨„Éà„É≠„É¢„ÉÄ„É≥", "Â§ßÁîªÈù¢HMI",
            "„Ç∑„Éº„Éà", "SUV", "„Éü„Éã„Éê„É≥", "„ÉØ„Ç¥„É≥", "„Éë„ÉÉ„Ç±„Éº„Ç∏", "„Éà„É¨„É≥„Éâ", "ÈõªÂãïÂåñ", "EV", "Ëç∑ÂÆ§",
            "AI", "„Ç®„Éº„Ç∏„Çß„É≥„Éà", "Ëá™ÂãïÈÅãËª¢", "R&D", "ËªΩÈáèÂåñ", "Èü≥Èüø", "ÂæåÂ∏≠", "„Ç§„É≥„Éï„Ç©„ÉÜ„Ç§„É≥„É°„É≥„Éà", "ÊÄßËÉΩ", "ÊúüÂæÖÂÄ§", "ÈÄö‰ø°", "Ë¶èÊ†º", "UX", "ÂÆâÂÖ®"
        ];
        const COUNTRY_FLAGS = {
            jp: "<span class='flag-icon flag-jp'></span>",
            cn: "<span class='flag-icon flag-cn'></span>",
            in: "<span class='flag-icon flag-in'></span>",
            us: "<span class='flag-icon flag-us'></span>",
            eu: "<span class='flag-icon flag-eu'></span>"
        };
        const COUNTRY_NAMES = { jp: "Êó•Êú¨", cn: "‰∏≠ÂõΩ", in: "„Ç§„É≥„Éâ", us: "Á±≥ÂõΩ", eu: "Ê¨ßÂ∑û" };
        const TITLE_ICONS = {
            world: "images/icon_world.png",
            jp: "images/icon_jp.png",
            cn: "images/icon_cn.png",
            in: "images/icon_in.png",
            us: "images/icon_us.png",
            eu: "images/icon_eu.png"
        };

        // ÁîªÂÉè„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÔºàË™≠„ÅøËæº„Åø‰∏çÂèØÊôÇ„Å´‰∏≠Â§Æ„Å∏„Äå„Ç§„É°„Éº„Ç∏ÁîªÂÉè„Äç„ÇíË°®Á§∫Ôºâ
        const FALLBACK_SRC = 'data:image/svg+xml;utf8,' + encodeURIComponent(`
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 450">
              <defs>
                <linearGradient id="g" x1="0" x2="1" y1="0" y2="1">
                  <stop offset="0%" stop-color="#1b2735"/>
                  <stop offset="100%" stop-color="#0d1520"/>
                </linearGradient>
              </defs>
              <rect width="800" height="450" fill="url(#g)" />
              <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle"
                fill="#cdd7e6" font-family="Inter, 'Noto Sans JP', sans-serif"
                font-size="40" font-weight="700">„Ç§„É°„Éº„Ç∏ÁîªÂÉè</text>
            </svg>
        `);

        let activeCountries = new Set(["world"]);
        let activeTags = new Set(["all"]);

        async function init() {
            if (window.LOADED_NEWS_DATA) {
                NEWS_DATA = window.LOADED_NEWS_DATA;
                setNewDateRangeFromNews(NEWS_DATA);
                document.getElementById("totalCount").textContent = NEWS_DATA.length;
                updateNewCountBadges();
                updateTitleIcon();
            } else {
                console.error("News data not loaded from JS file");
            }

            const tagFilters = document.getElementById("tagFilters");
            ALL_TAGS.forEach(tag => {
                const chip = document.createElement("span");
                chip.className = "chip";
                chip.dataset.tag = tag;
                chip.textContent = tag;
                tagFilters.appendChild(chip);
            });

            const tagToggle = document.getElementById("tagToggle");
            if (tagToggle) {
                tagToggle.addEventListener("click", () => {
                    const expanded = tagFilters.classList.toggle("expanded");
                    tagToggle.textContent = expanded ? "Èñâ„Åò„Çã" : "„ÇÇ„Å£„Å®Ë¶ã„Çã";
                    tagToggle.setAttribute("aria-expanded", expanded ? "true" : "false");
                });
            }

            document.getElementById("totalCount").textContent = NEWS_DATA.length;
            updateNewCountBadges();

            const today = new Date().toISOString().split("T")[0];


            document.getElementById("dateTo").value = today;

            const params = new URLSearchParams(window.location.search);
            if (params.has("countries")) {
                activeCountries = new Set(params.get("countries").split(","));
                updateCountryChips();
            }
            if (params.has("tags")) {
                const t = params.get("tags").split(",");
                activeTags = new Set(t.includes("all") ? ["all"] : t);
                updateTagChips();
            }
            if (params.has("from")) document.getElementById("dateFrom").value = params.get("from");
            if (params.has("to")) document.getElementById("dateTo").value = params.get("to");
            if (params.has("sort")) document.getElementById("sortOrder").value = params.get("sort");

            document.getElementById("countryFilters").addEventListener("click", handleCountryClick);
            document.getElementById("tagFilters").addEventListener("click", handleTagClick);
            document.getElementById("dateFrom").addEventListener("change", applyFilters);
            document.getElementById("dateTo").addEventListener("change", applyFilters);
            document.getElementById("searchInput").addEventListener("input", applyFilters);
            document.getElementById("sortOrder").addEventListener("change", () => {
                applyFilters();
                updateURL();
            });

            applyFilters();

            // „Ç¢„ÇØ„Çª„Çπ„Ç´„Ç¶„É≥„Çø„ÉºÊõ¥Êñ∞
            updateAccessCounter();
        }

        function handleCountryClick(e) {
            const chip = e.target.closest(".chip");
            if (!chip || !chip.dataset.country) return;
            const country = chip.dataset.country;
            if (country === "world") {
                activeCountries = new Set(["world"]);
            } else {
                // Âçò‰∏ÄÈÅ∏Êäû„Å´Â§âÊõ¥ÔºöÈÅ∏Êäû„Åó„ÅüÂõΩ„ÅÆ„Åø„Çí„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å´
                activeCountries = new Set([country]);
            }
            updateCountryChips();
            applyFilters();
            updateURL();
        }

        function handleTagClick(e) {
            if (!e.target.classList.contains("chip")) return;
            const tag = e.target.dataset.tag;
            if (tag === "all") {
                activeTags = new Set(["all"]);
            } else {
                activeTags.delete("all");
                if (activeTags.has(tag)) activeTags.delete(tag);
                else activeTags.add(tag);
                if (activeTags.size === 0) activeTags.add("all");
            }
            updateTagChips();
            applyFilters();
            updateURL();
        }

        function updateCountryChips() {
            document.querySelectorAll("#countryFilters .chip").forEach(c => {
                c.classList.toggle("active", activeCountries.has(c.dataset.country));
            });
            updateTitleIcon();
        }

        function updateTagChips() {
            document.querySelectorAll("#tagFilters .chip").forEach(c => {
                c.classList.toggle("active", activeTags.has(c.dataset.tag));
            });
        }



        // „Çø„Ç∞„ÇØ„É™„ÉÉ„ÇØ„ÅßÊ§úÁ¥¢
        function searchByTag(tag) {
            document.getElementById("searchInput").value = tag;
            applyFilters();
        }


        // „Ç¢„ÇØ„Çª„Çπ„Ç´„Ç¶„É≥„Çø„ÉºÔºàFirebaseÈÄ£Êê∫Ôºâ
        async function updateAccessCounter() {
            try {
                const today = new Date().toISOString().split('T')[0];
                const counterRef = window.db.collection('pageStats').doc('accessCounter');

                // „Éà„É©„É≥„Ç∂„ÇØ„Ç∑„Éß„É≥„Åß„Ç´„Ç¶„É≥„Çø„Éº„Çí„Ç§„É≥„ÇØ„É™„É°„É≥„Éà
                await window.db.runTransaction(async (transaction) => {
                    const doc = await transaction.get(counterRef);
                    if (!doc.exists) {
                        transaction.set(counterRef, {
                            total: 1,
                            daily: { [today]: 1 },
                            lastUpdated: today
                        });
                    } else {
                        const data = doc.data();
                        const newTotal = (data.total || 0) + 1;
                        const daily = data.daily || {};
                        daily[today] = (daily[today] || 0) + 1;

                        // Âè§„ÅÑÊó•‰ªò„ÅÆ„Éá„Éº„Çø„ÇíÂâäÈô§Ôºà7Êó•‰ª•‰∏äÂâçÔºâ
                        const weekAgo = new Date();
                        weekAgo.setDate(weekAgo.getDate() - 7);
                        Object.keys(daily).forEach(date => {
                            if (new Date(date) < weekAgo) delete daily[date];
                        });

                        transaction.update(counterRef, {
                            total: newTotal,
                            daily: daily,
                            lastUpdated: today
                        });
                    }
                });

                // ÊúÄÊñ∞„ÅÆ„Ç´„Ç¶„É≥„Éà„ÇíÂèñÂæó„Åó„Å¶Ë°®Á§∫
                const snapshot = await counterRef.get();
                if (snapshot.exists) {
                    const data = snapshot.data();
                    document.getElementById('totalVisits').textContent = (data.total || 0).toLocaleString();
                    document.getElementById('todayVisits').textContent = ((data.daily && data.daily[today]) || 0).toLocaleString();
                }
            } catch (error) {
                console.log('Access counter not available:', error.message);
                document.getElementById('totalVisits').textContent = '-';
                document.getElementById('todayVisits').textContent = '-';
            }
        }

        function applyFilters() {
            const from = document.getElementById("dateFrom").value;
            const to = document.getElementById("dateTo").value;
            const searchText = document.getElementById("searchInput").value.toLowerCase();
            const sortOrder = document.getElementById("sortOrder").value;

            // 1. Filter
            const filteredData = NEWS_DATA.filter(n => {
                // Country Filter
                if (!activeCountries.has("world") && !activeCountries.has(n.country)) return false;

                const searchable = (n.id + " " + n.title + " " + n.desc + " " + (n.summary || "") + " " + (n.note || "") + " " + n.tags.join(" ")).toLowerCase();

                // Tag Filter (tag text can match title/desc as well)
                if (!activeTags.has("all")) {
                    const tagMatches = [...activeTags].some(tag => searchable.includes(tag.toLowerCase()));
                    if (!tagMatches) return false;
                }

                // Date Filter (YYYY-MM-DD string comparison works)
                if (from && n.date < from) return false;
                if (to && n.date > to) return false;

                // Text Search
                if (searchText && !searchable.includes(searchText)) return false;

                return true;
            });

            // 2. Sort
            const countryOrder = { jp: 0, cn: 1, in: 2, us: 3, eu: 4 };
            const interactions = window.interactionsData || {};
            filteredData.sort((a, b) => {
                if (sortOrder === "date-asc") {
                    return a.date.localeCompare(b.date);
                } else if (sortOrder === "country") {
                    // First by country (jp -> cn -> in), then by date desc within same country
                    const countryDiff = (countryOrder[a.country] ?? 99) - (countryOrder[b.country] ?? 99);
                    if (countryDiff !== 0) return countryDiff;
                    return b.date.localeCompare(a.date);
                } else if (sortOrder === "likes-desc") {
                    // Sort by likes (descending), then by date desc
                    const likesA = interactions[a.id]?.likes || 0;
                    const likesB = interactions[b.id]?.likes || 0;
                    if (likesB !== likesA) return likesB - likesA;
                    return b.date.localeCompare(a.date);
                } else if (sortOrder === "comments-desc") {
                    // Sort by comment count (descending), then by date desc
                    const commentsA = interactions[a.id]?.comments || 0;
                    const commentsB = interactions[b.id]?.comments || 0;
                    if (commentsB !== commentsA) return commentsB - commentsA;
                    return b.date.localeCompare(a.date);
                } else {
                    return b.date.localeCompare(a.date);
                }
            });

            // 3. Render (Pagination)
            const grid = document.getElementById("newsGrid");
            grid.innerHTML = "";

            const itemsToShow = filteredData.slice(0, visibleLimit);

            itemsToShow.forEach(n => {
                const card = document.createElement("article");
                card.className = "card";
                const isNew = isNewContent(n);
                card.innerHTML = `
            <div class="thumb">
                <img src="${n.img}" alt="${n.title}" loading="lazy" class="img-with-fallback">
                <div class="fallback-overlay">„Ç§„É°„Éº„Ç∏ÁîªÂÉè</div>
                ${isNew ? '<span class="new-badge">New</span>' : ''}
                <span class="country-badge">${COUNTRY_FLAGS[n.country]} ${COUNTRY_NAMES[n.country]}</span>
                <span class="date-badge">${n.date}</span>
                ${(n.img.includes('unsplash') || n.img.includes('placeholder') || (n.note && n.note.includes('‚Äª'))) ? '<div class="image-note">‚Äª„Ç§„É°„Éº„Ç∏ÁîªÂÉè</div>' : ''}
            </div>
            <div class="content">
                <div class="title">${n.title}</div>
                <p class="desc">${n.desc}</p>
                ${n.summary ? `
                <div class="summary-wrapper">
                    <button class="summary-btn" onclick="toggleSummary(this)">Ë©≥Á¥∞Ë¶ÅÁ¥Ñ„ÇíË¶ã„Çã</button>
                    <div class="summary-content">${n.summary}</div>
                </div>` : ''}
                <div class="card-tags">${n.tags.map(t => `<span class="card-tag" onclick="searchByTag('${t}')" style="cursor:pointer;">${t}</span>`).join("")}</div>

                
                <div class="actions">
                    <a class="btn" href="${n.url}" target="_blank">Ë®ò‰∫ã„ÇíË™≠„ÇÄ</a>
                    
                    <button class="action-btn" onclick="toggleLike('${n.id}', this)">
                        <span>‚ô°</span> <span class="count">0</span>
                    </button>
                    <button class="action-btn btn-comment" onclick="toggleComments('${n.id}', this)">
                        <span>üí¨</span> <span class="count">0</span>
                    </button>

                    <span class="source">${n.source}</span>
                    <span class="id-badge">${n.id}</span>
                </div>
    
                <div class="comment-section">
                    <div class="comment-list">
                        <!-- Demo Comments -->
                    </div>
                    <div class="comment-input-area">
                        <input type="text" class="comment-input" placeholder="„Ç≥„É°„É≥„Éà„ÇíÂÖ•Âäõ..." onkeypress="if(event.key==='Enter') submitComment('${n.id}', this)">
                        <button class="comment-submit" onclick="submitComment('${n.id}', this.previousElementSibling)">ÈÄÅ‰ø°</button>
                    </div>
                </div>
    
            </div>`;
                grid.appendChild(card);
            });

            // Update Counts
            document.getElementById("visibleCount").textContent = filteredData.length;

            // Load More Button Visibility
            const loadMoreBtn = document.getElementById("loadMoreBtn");
            if (loadMoreBtn) {
                if (filteredData.length > visibleLimit) {
                    loadMoreBtn.style.display = "inline-block";
                    loadMoreBtn.textContent = `„ÇÇ„Å£„Å®Ë¶ã„Çã („ÅÇ„Å® ${filteredData.length - visibleLimit} ‰ª∂)`;
                } else {
                    loadMoreBtn.style.display = "none";
                }
            }

            // Empty state removed
            wireImageFallbacks(document);
            renderInsights();
        }

        function loadMore() {
            visibleLimit += 30;
            applyFilters();
        }


        function updateURL() {
            const params = new URLSearchParams();
            if (!activeCountries.has("world")) params.set("countries", [...activeCountries].join(","));
            if (!activeTags.has("all")) params.set("tags", [...activeTags].join(","));
            const from = document.getElementById("dateFrom").value;
            const to = document.getElementById("dateTo").value;
            if (from) params.set("from", from);
            if (to) params.set("to", to);
            const sortOrder = document.getElementById("sortOrder").value;
            if (sortOrder && sortOrder !== "date-desc") params.set("sort", sortOrder);
            const newURL = params.toString() ? `${location.pathname}?${params}` : location.pathname;
            history.replaceState(null, "", newURL);
        }



        let insightsVisibleLimit = 3;  // ÂàùÊúüË°®Á§∫„ÅØ3ÂõûÂàÜ

        function renderInsights() {
            const container = document.getElementById("insightsContainer");
            container.innerHTML = "";

            const from = document.getElementById("dateFrom").value;
            const to = document.getElementById("dateTo").value;
            const searchText = document.getElementById("searchInput").value.toLowerCase();

            // ÊúÄÊñ∞„ÅÆ„Ç§„É≥„Çµ„Ç§„ÉàÊó•‰ªò„ÇíÂèñÂæó
            const latestInsightDate = DAILY_INSIGHTS.length > 0 ? DAILY_INSIGHTS[0].date : null;

            let visibleCount = 0;
            const filteredInsights = DAILY_INSIGHTS.filter(day => {
                // „Åì„ÅÆÊó•‰ªò„ÅåÊúÄÊñ∞„Åã„Å©„ÅÜ„Åã„ÇíÂà§ÂÆöÔºà2026-01-06„ÇíÂê´„ÇÄÊó•‰ªò„ÅÆ„ÅøNewÔºâ
                const isNewInsight = isNewInsightDate(day.date);
                // Date Filter (supports single date or range like YYYY-MM-DD„ÄúYYYY-MM-DD)
                let rangeStart = day.date;
                let rangeEnd = day.date;
                if (day.date.includes("„Äú") || day.date.includes("ÔΩû") || day.date.includes("~")) {
                    const parts = day.date.split(/[„ÄúÔΩû~]/).map(s => s.trim()).filter(Boolean);
                    if (parts.length >= 2) {
                        rangeStart = parts[0];
                        rangeEnd = parts[1];
                    }
                }
                if (from && rangeEnd < from) return false;
                if (to && rangeStart > to) return false;

                // Active Countries Logic
                const showJp = (activeCountries.has("world") || activeCountries.has("jp")) && day.analysis.jp;
                const showCn = (activeCountries.has("world") || activeCountries.has("cn")) && day.analysis.cn;
                const showIn = (activeCountries.has("world") || activeCountries.has("in")) && day.analysis.in;
                const showUs = (activeCountries.has("world") || activeCountries.has("us")) && day.analysis.us;
                const showEu = (activeCountries.has("world") || activeCountries.has("eu")) && day.analysis.eu;

                // Text Search Check
                let hasMatch = false;
                if (!searchText) {
                    hasMatch = true;
                } else {
                    const allText = [
                        day.date,
                        showJp ? day.analysis.jp + JSON.stringify(day.ideas.jp || []) : "",
                        showCn ? day.analysis.cn + JSON.stringify(day.ideas.cn || []) : "",
                        showIn ? day.analysis.in + JSON.stringify(day.ideas.in || []) : "",
                        showUs ? day.analysis.us + JSON.stringify(day.ideas.us || []) : "",
                        showEu ? day.analysis.eu + JSON.stringify(day.ideas.eu || []) : ""
                    ].join(" ").toLowerCase();
                    if (allText.includes(searchText)) hasMatch = true;
                }

                if (!hasMatch) return false;

                // Only render if there is content to show for active countries
                if (!showJp && !showCn && !showIn && !showUs && !showEu) return false;
                return true;
            });

            // Ë°®Á§∫„Åô„Çã„Ç§„É≥„Çµ„Ç§„Éà„ÇíÂà∂Èôê
            const insightsToShow = filteredInsights.slice(0, insightsVisibleLimit);

            insightsToShow.forEach(day => {
                // „Åì„ÅÆÊó•‰ªò„ÅåÊúÄÊñ∞„Åã„Å©„ÅÜ„Åã„ÇíÂà§ÂÆöÔºà2026-01-06„ÇíÂê´„ÇÄÊó•‰ªò„ÅÆ„ÅøNewÔºâ
                const isNewInsight = isNewInsightDate(day.date);

                // ÂõΩÂà•Ë°®Á§∫„Éï„É©„Ç∞„ÇíÂÜçË®àÁÆó
                const showJp = (activeCountries.has("world") || activeCountries.has("jp")) && day.analysis.jp;
                const showCn = (activeCountries.has("world") || activeCountries.has("cn")) && day.analysis.cn;
                const showIn = (activeCountries.has("world") || activeCountries.has("in")) && day.analysis.in;
                const showUs = (activeCountries.has("world") || activeCountries.has("us")) && day.analysis.us;
                const showEu = (activeCountries.has("world") || activeCountries.has("eu")) && day.analysis.eu;

                // Create Wrapper
                const wrapper = document.createElement("div");
                wrapper.className = "daily-insight-group";

                // Analysis Section
                let analysisHTML = `
                    <section class="analysis-section" style="margin-top: 48px;">
                        <h2 class="section-title"><span class="section-icon">üí°</span> ËÄÉÂØü (${day.date})${isNewInsight ? '<span class="idea-new-badge">New</span>' : ''}</h2>
                        <div class="analysis-grid">
                `;

                if (showJp) analysisHTML += `
                    <div class="analysis-card region-jp">
                        <div class="flag-header">
                            <span class="flag-icon flag-jp" style="width:32px; height:22px;"></span>
                            <span class="country-label">JAPAN</span>
                        </div>
                        <div class="analysis-text-body">${day.analysis.jp}</div>
                    </div>`;

                if (showCn) analysisHTML += `
                    <div class="analysis-card region-cn">
                        <div class="flag-header">
                            <span class="flag-icon flag-cn" style="width:32px; height:22px;"></span>
                            <span class="country-label">CHINA</span>
                        </div>
                        <div class="analysis-text-body">${day.analysis.cn}</div>
                    </div>`;

                if (showIn) analysisHTML += `
                    <div class="analysis-card region-in">
                        <div class="flag-header">
                            <span class="flag-icon flag-in" style="width:32px; height:22px;"></span>
                            <span class="country-label">INDIA</span>
                        </div>
                        <div class="analysis-text-body">${day.analysis.in}</div>
                    </div>`;

                if (showUs) analysisHTML += `
                    <div class="analysis-card region-us">
                        <div class="flag-header">
                            <span class="flag-icon flag-us" style="width:32px; height:22px;"></span>
                            <span class="country-label">USA</span>
                        </div>
                        <div class="analysis-text-body">${day.analysis.us}</div>
                    </div>`;

                if (showEu) analysisHTML += `
                    <div class="analysis-card region-eu">
                        <div class="flag-header">
                            <span class="flag-icon flag-eu" style="width:32px; height:22px;"></span>
                            <span class="country-label">EUROPE</span>
                        </div>
                        <div class="analysis-text-body">${day.analysis.eu}</div>
                    </div>`;

                analysisHTML += `</div></section>`;


                // Ideas Section
                let ideasHTML = `
                    <section class="ideas-section">
                        <h2 class="section-title"><span class="section-icon">üöÄ</span> ‰ºÅÁîª„Ç¢„Ç§„Éá„Ç¢‰æã (${day.date})${isNewInsight ? '<span class="idea-new-badge">New</span>' : ''}</h2>
                `;

                const renderIdeas = (ideas, regionName, regionClass, flagIcon) => {
                    if (ideas.length > 0) {
                        ideasHTML += `
                            <div class="region-section ${regionClass}">
                                <div class="region-title-wrapper">
                                    ${flagIcon}
                                    <span class="region-title-text">${regionName}</span>
                                </div>
                                <div class="ideas-grid">
                        `;

                        ideas.forEach(idea => {
                            ideasHTML += `
                                <div class="idea-card">
                                ${idea.img ? `<div class="idea-image-wrapper"><img src="${idea.img}" class="idea-img img-with-fallback" loading="lazy"><div class="fallback-overlay">„Ç§„É°„Éº„Ç∏ÁîªÂÉè</div></div>` : ""}
                                    <div class="idea-content">
                                        <div class="idea-header">
                                            <span class="idea-number">${idea.id}</span>
                                            <span class="idea-title">${idea.title}</span>
                                        </div>
                                        <p class="idea-desc">${idea.desc}</p>
                                        <div class="actions">
                                            <button class="action-btn" onclick="toggleLike('${idea.id}', this)">
                                                <span>‚ô°</span> <span class="count">0</span>
                                            </button>
                                            <button class="action-btn btn-comment" onclick="toggleComments('${idea.id}', this)">
                                                <span>üí¨</span> <span class="count">0</span>
                                            </button>
                                        </div>
                                        <div class="comment-section">
                                            <div class="comment-list"></div>
                                            <div class="comment-input-area">
                                                <input type="text" class="comment-input" placeholder="„Ç≥„É°„É≥„Éà..." onkeypress="if(event.key==='Enter') submitComment('${idea.id}', this)">
                                                <button class="comment-submit" onclick="submitComment('${idea.id}', this.previousElementSibling)">ÈÄÅ‰ø°</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `;
                        });

                        ideasHTML += `</div></div>`;
                    }
                };

                // Note: removed single quotes around font-size style in Python string to avoid conflict
                if (showJp) renderIdeas(day.ideas.jp || [], 'Êó•Êú¨Â∏ÇÂ†¥Âêë„Åë', 'jp', '<span class="flag-icon flag-jp" style="width:28px; height:18px;"></span>');
                if (showCn) renderIdeas(day.ideas.cn || [], '‰∏≠ÂõΩÂ∏ÇÂ†¥Âêë„Åë', 'cn', '<span class="flag-icon flag-cn" style="width:28px; height:18px;"></span>');
                if (showIn) renderIdeas(day.ideas.in || [], '„Ç§„É≥„ÉâÂ∏ÇÂ†¥Âêë„Åë', 'in', '<span class="flag-icon flag-in" style="width:28px; height:18px;"></span>');
                if (showUs) renderIdeas(day.ideas.us || [], 'Á±≥ÂõΩÂ∏ÇÂ†¥Âêë„Åë', 'us', '<span class="flag-icon flag-us" style="width:28px; height:18px;"></span>');
                if (showEu) renderIdeas(day.ideas.eu || [], 'Ê¨ßÂ∑ûÂ∏ÇÂ†¥Âêë„Åë', 'eu', '<span class="flag-icon flag-eu" style="width:28px; height:18px;"></span>');

                ideasHTML += `</section>`;

                wrapper.innerHTML = analysisHTML + ideasHTML;
                container.appendChild(wrapper);
            });
            wireImageFallbacks(container);

            // „ÇÇ„Å£„Å®Ë¶ã„Çã„Éú„Çø„É≥Ôºà„Ç§„É≥„Çµ„Ç§„ÉàÁî®Ôºâ
            if (filteredInsights.length > insightsVisibleLimit) {
                const loadMoreDiv = document.createElement("div");
                loadMoreDiv.style.cssText = "text-align:center; margin-top:20px;";
                loadMoreDiv.innerHTML = `<button onclick="loadMoreInsights()" class="btn" style="padding:12px 24px;">
                    üìö „ÇÇ„Å£„Å®Ë¶ã„Çã („ÅÇ„Å® ${filteredInsights.length - insightsVisibleLimit} ‰ª∂)
                </button>`;
                container.appendChild(loadMoreDiv);
            }
        }

        function loadMoreInsights() {
            insightsVisibleLimit += 3;
            renderInsights();
        }

        function wireImageFallbacks(scope = document) {
            scope.querySelectorAll("img.img-with-fallback").forEach(img => {
                if (img.dataset.fallbackWired) return;
                img.dataset.fallbackWired = "1";
                img.addEventListener("load", () => {
                    const overlay = (img.closest(".thumb") || img.closest(".idea-image-wrapper"))?.querySelector(".fallback-overlay");
                    if (overlay) overlay.style.display = "none";
                    const src = img.currentSrc || img.src || "";
                    const isPlaceholder = src.includes("placeholder") || src.includes("unsplash") || src.includes("thumb_default.png");
                    if (!isPlaceholder) {
                        const note = (img.closest(".thumb") || img.closest(".idea-image-wrapper"))?.querySelector(".image-note");
                        if (note) note.style.display = "none";
                    }
                });
                img.addEventListener("error", () => {
                    if (img.dataset.failed) return;
                    img.dataset.failed = "1";
                    img.src = FALLBACK_SRC;
                    img.style.objectFit = "contain";
                    const overlay = (img.closest(".thumb") || img.closest(".idea-image-wrapper"))?.querySelector(".fallback-overlay");
                    if (overlay) overlay.style.display = "flex";
                });
            });
        }

        function toggleSummary(btn) {
            const content = btn.nextElementSibling;
            btn.classList.toggle('open');
            content.classList.toggle('open');

            if (content.classList.contains('open')) {
                content.style.maxHeight = content.scrollHeight + "px";
                btn.textContent = "Ë©≥Á¥∞Ë¶ÅÁ¥Ñ„ÇíÈñâ„Åò„Çã";
            } else {
                content.style.maxHeight = null;
                btn.textContent = "Ë©≥Á¥∞Ë¶ÅÁ¥Ñ„ÇíË¶ã„Çã";
            }
        }

        document.addEventListener("DOMContentLoaded", init);
    </script>
</body>

</html>
